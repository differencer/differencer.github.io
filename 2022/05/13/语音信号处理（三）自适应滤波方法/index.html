<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">语音信号处理（三）自适应滤波方法 | t&#39;blog</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "没错就是爱折腾";
  mashiro_option.author_name = "就是爱折腾";
  mashiro_option.site_url = "/about/";
  /*
  mashiro_option.v_appId = "";
  mashiro_option.v_appKey = "";
  */
  mashiro_option.v_appId = "";
  mashiro_option.v_appKey = "";

  
  mashiro_option.mathjax = "1";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(1).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(2).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(3).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(4).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(5).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(6).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(7).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(8).jpg.webp".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
<meta name="generator" content="Hexo 6.1.0"></head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="/about/">
          <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>Better to ask the way than go astray</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/differencer" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://weibo.com/u/5856795355" target="_blank" class="social-github" title="sina">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/sina.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://space.bilibili.com/20713910" target="_blank" class="social-github" title="bilibili">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/bilibili.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://blog.csdn.net/differencer?type=blog" target="_blank" class="social-github" title="CSDN">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/csdn.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/qq.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/qq.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">没错</span>
            <span class="shironeko">就是爱折腾</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/archives">
                          <i class="fa fa-archive faa-shake" aria-hidden="true"></i>
                          时轴
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%94%9F%E6%B4%BB/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E5%85%B6%E4%BB%96/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          其他
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/%E9%98%85%E8%AF%BB/">
                          <i class="fa fa fa-book faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-bar-chart faa-shake" aria-hidden="true"></i>
                    统计
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/">
                          <i class="fa fa-book faa-bounce" aria-hidden="true"></i>
                          标签
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/">
                          <i class="fa fa-tasks faa-shake" aria-hidden="true"></i>
                          分类
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/links/">
                          <i class="fa fa-link faa-shake" aria-hidden="true"></i>
                          友链
                        </a>
                      </li>
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://s2.loli.net/2022/05/13/SAeY6r5BlkG9Jm3.png);" src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://s2.loli.net/2022/05/13/SAeY6r5BlkG9Jm3.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      语音信号处理（三）自适应滤波方法</h1>
      <p class="entry-census">
        <span>
          <a href="/about/">
            <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/custom/avatar.jpg">
          </a>
        </span>
        <span>
          <a href="/about/">differencer</a>
        </span>
        <span class="bull">
        ·</span>
        2022-5-13<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <p>自适应滤波 是一种理论体系，应用于内容都非常广泛</p>
<p>滤波器</p>
<ul>
<li><p>作用：改变信号的频谱</p>
<ul>
<li>模拟滤波器：由R、L、C构成的模拟电路，例如A/D前的抗混叠滤波器（anti-alias filter）</li>
<li>数字滤波器：由数字加法器、乘法器、延时器构成，基于数字信号运算实现。（数字通信系统中，不做特殊说明时 一般都指数字滤波器）</li>
</ul>
</li>
<li><p>自适应滤波器：一种能够根据输入信号自动调整自身参数的数字滤波器。<br>非自适应滤波器：具有静态滤波器系数的数字滤波器，这些静态系数构成了滤波器的传递函数。</p>
<ul>
<li>自适应滤波器的应用场景：无法得知输入信号和噪声统计特性的情况（也即非平稳信号）。滤波器自身能够在工作过程中学习或估计信号的统计特性，并以此为依据调整自身参数，以达到某种准则/代价函数下的最优滤波效果。此外还能跟踪信号变化。<br><img src="https://s2.loli.net/2022/05/13/SAeY6r5BlkG9Jm3.png" alt=""></li>
</ul>
</li>
</ul>
<h1 id="一、LMS（最小均方误差）算法"><a href="#一、LMS（最小均方误差）算法" class="headerlink" title="一、LMS（最小均方误差）算法"></a>一、LMS（最小均方误差）算法</h1><p>这是一个最基本的自适应滤波的算法，应用多，原理也比较简单。</p>
<h2 id="1-1、-从N阶线性系统出发"><a href="#1-1、-从N阶线性系统出发" class="headerlink" title="1.1、 从N阶线性系统出发"></a>1.1、 从N阶线性系统出发</h2><p>设一个信号经过噪声因素被接受为$x(n)$</p>
<p>设接收信号$x(n)$通过了一个N阶滤波器，参数为{$w_i(n)$}，则滤波器输出为：</p>
<script type="math/tex; mode=display">y(n)=\sum_{i=0}^{N-1} w_{i}(n) x(n-i)=\mathbf{w}^{T}(n) \mathbf{x}(n)=\mathbf{x}^{T}(n) \mathbf{w}(n)</script><p>后面两种是卷积结果（的一个时刻，n时刻）的向量表示（可以动手写一些是不是这样）<br>其中</p>
<script type="math/tex; mode=display">\mathbf{x}(n)=[x(n), \quad x(n-1), \quad \ldots \quad x(n-N+1)]^{T}</script><script type="math/tex; mode=display">\mathbf{w}(n)=\left[\begin{array}{llll}w_{0}(n), & w_{1}(n), & \ldots & w_{N-1}(n)\end{array}\right]^{T}</script><p>注意到，由于滤波器系数$w(n)$是随着时间n变化的，也即随着输入变化不断“学习”的，所以每个时刻的滤波器系数应当不同,所以写为时间的函数。</p>
<p><strong>期望输出</strong>为$d(n)$,定义误差信号：</p>
<script type="math/tex; mode=display">e(n)=d(n)-y(n)=d(n)-\mathbf{w}^{T}(n) \mathbf{x}(n)</script><p>我们定义的误差采用的滤波器系数是当前时刻的，这种误差在传统的自适应滤波器算法当中也叫后验误差，这里后验的意思就是算当前误差的时候已经用到了当前时刻的滤波器系数向量了。</p>
<p>现在已经定义了误差，那么下一步就是<strong>寻找某种优化准则</strong>，以及基于这个准则，<strong>定义一种目标函数</strong>来最小化这个目标函数即可。</p>
<p>自适应滤波当中最常用的准则就是MMSE（最小均方误差准则），在这种准则下面就可以很自然的定义目标函数:将目标函数写成均方误差的形式，目标函数如下：</p>
<script type="math/tex; mode=display">
J(\mathbf{w})=E\left\{|e(n)|^{2}\right\}=E\left\{\left|d(n)-\mathbf{w}^{T}(n) \mathbf{x}(n)\right|^{2}\right\}</script><h2 id="1-2、维纳滤波"><a href="#1-2、维纳滤波" class="headerlink" title="1.2、维纳滤波"></a>1.2、维纳滤波</h2><p>为了最小化目标函数， 需要计算$J(\mathbf{w})$对$\mathbf{w}$的导数，并令导数为零，结果如下：</p>
<script type="math/tex; mode=display">
E\left\{\mathbf{x}(n) \mathbf{x}^{T}(n)\right\} \mathbf{w}(n)-E\{\mathbf{x}(n) d(n)\}=\mathbf{R w}-\mathbf{r}=\mathbf{0}</script><p>其中 $\mathbf{R}=E\left\{\mathbf{x}(n) \mathbf{x}^{T}(n)\right\} $,$\mathbf{r}=E\{\mathbf{x}(n) d(n)\}$<br>矩阵$\mathbf{R}$就是<strong>输入的 期望自相关矩阵</strong>，而$\mathbf{r}$是<strong>输入信号与期望信号的 相关向量</strong></p>
<p>那么再MMSE准则下，最优的滤波器学习系数就是</p>
<script type="math/tex; mode=display">
\mathbf{w}_{o p t}=\mathbf{R}^{-1} \mathbf{r}</script><p>得到的解叫做维纳解，也是在<strong>MMSE意义下的最优解</strong>，<strong>以这种解为系数的滤波器称为Wiener滤波器</strong>。</p>
<p>Wiener滤波器是一种在信号处理领域极具理论价值的滤波器，但是，在实际应用过程中却又诸多缺陷。</p>
<ul>
<li>首先：不适用于非平稳过程（因为 相关矩阵 和相关向量 都是<strong>期望</strong>的形式），语音信号就是非平稳信号</li>
<li>再求解过程中需要用到信号的所有历史数据（包括自相关矩阵，以及相关向量），(当信号是非平稳的时)当增加一个数据过后，滤波器就要重新求解系数。（或者在已知所有 输入以及期望信号的情况下，一次性算出 滤波器系数，是一种静态滤波器，不能跟踪变化）</li>
</ul>
<p>如果对于上述过程还是不太理解，也可以翻阅知乎的这篇<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/358236441?utm_medium=social&amp;utm_oi=775650389734203392">博客</a></p>
<h2 id="1-3、自适应滤波器（-迭代算法，LMS算法）"><a href="#1-3、自适应滤波器（-迭代算法，LMS算法）" class="headerlink" title="1.3、自适应滤波器（ 迭代算法，LMS算法）"></a>1.3、自适应滤波器（ 迭代算法，LMS算法）</h2><p>由于涉及<strong>数学期望</strong>，在实际应用中，绝大多数情况下我们无法获得信号真实的自相关矩阵以及输入信号与期望输出之间的互相关向量，因此，实际应用中，我们用下式的<strong>瞬时梯度</strong>的<strong>迭代更新方案</strong>，<strong>代替数学期望方案</strong>，PS：梯度隐含着这是一个可导函数，梯度是一个向量(隐含了大小和方向)，方向是函数值变化（上升）最快的方向向量，大小是变化的快慢。</p>
<script type="math/tex; mode=display">
\hat{\nabla}(n)=-2 e(n) \mathbf{x}(n)</script><p>求取的<strong>瞬时梯度（的负梯度方向）代表了滤波器系数应该调整的方向</strong>，也就是误差下降的方向<br>于是，我们得到了标准时域LMS算法的更新公式:（也即基于采样点更新的标准LMS算法滤波器系数更新公式）</p>
<script type="math/tex; mode=display">
\mathbf{w}(n+1)=\mathbf{w}(n)+2 \mu \mathbf{x}(n) e(n)</script><p>其中，$2\mu $表示调整步长 ,由于是一个可变可调的参数，大部分文献也写z整体直接写为$\mu$。</p>
<p>关于LMS算法步长的取值范围， 这里不给<a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_36161424/article/details/90477222">推导</a>的给出：</p>
<script type="math/tex; mode=display">
0<\mu(or\quad 2\mu)\leq \lambda_{max}</script><p>$\lambda_{max}$为 输入信号$x(n)$的自相关矩阵$\mathbf{R}$的最大特征值;</p>
<p>PS：求特征值可以用matlab eig(函数)<br><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">rho_max <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">eig</span><span class="token punctuation">(</span>input_ref<span class="token operator">'</span><span class="token operator">*</span>input_ref<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">% 输入信号相关矩阵的最大特征值</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br>为了避免求特征值的麻烦，有时也可以用矩阵的迹$t_r(\mathbf{R})=\sum \lambda=\sum^{L}_{k=0} x^2(k)$来替代。 即$0&lt;\mu&lt;t_r(\mathbf{R})$<br>标准LMS算法的执行流程：</p>
<blockquote>
<p>步骤：<br>    1) 滤波器初始化：<br>    2) 对每一个新的输入采样 ，计算输出信号<br>    3) 利用期望输出 ，根据<strong>误差公式</strong>计算误差信号 ，得到梯度(更新向量)<br>    4) 利用<strong>LMS算法的更新公式</strong>更新滤波器系数：<br>    5) 返回步骤 2，直至结束，可以得到输出序列和误差序列。</p>
</blockquote>
<p>  LMS算法的基本思想 ——梯度下降</p>
<ul>
<li><p>LMS使用瞬时梯度作为每一步滤波器向量更新的依据，由于瞬时梯度就是目标函数真实梯度的无偏估计，这样这样保证了标准LMS算法的总体更新趋势使目标函数达到最小</p>
<p>LMS算法的优缺点：</p>
<blockquote>
<p>优点：简单，易于实现<br>缺点：收敛速度慢（虽然 瞬时梯度是 真实梯度的无偏估计，但是估计的方差不为零，估计方差存在误差（噪声），这种方差的存在导致了LMS收敛速度比较慢）</p>
</blockquote>
</li>
</ul>
<p><strong>代码实现</strong></p>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab"><span class="token keyword">function</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span>e<span class="token punctuation">,</span>w<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">MyLMS</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span>mu<span class="token punctuation">,</span>x<span class="token punctuation">,</span>d<span class="token punctuation">)</span>
<span class="token comment">% 输入参数</span>
<span class="token comment">% L 滤波器阶数</span>
<span class="token comment">% mu 学习步长;  一般玄奇</span>
<span class="token comment">% x 输入信号; 是指 直接进入滤波器于滤波器系数相卷积的那一路</span>
<span class="token comment">% d 期望信号：是指 不进入滤波器，而只作为“参考”，产生误差信号的那一路</span>
<span class="token comment">% output 输出：是指滤波器的直接输出</span>
<span class="token comment">% w 滤波器系数： </span>
<span class="token comment">% 注意 输入信号于期望 输入应该保证一样长</span>

N<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">% 总输入长度</span>
w <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">% 行向量</span>
e<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
y<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>    

x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> x<span class="token operator">'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">%  行向量  </span>
  <span class="token keyword">for</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>N  <span class="token comment">% 每一个采样点“前进一步”</span>
      m <span class="token operator">=</span> n <span class="token operator">+</span> L <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">% n是“起始点”，m则是“结束点”</span>
      
      xpad <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span>m<span class="token operator">-</span>L<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>m<span class="token punctuation">)</span><span class="token operator">'</span><span class="token punctuation">;</span>	    
      <span class="token comment">% 列向量  ：看x 的定义中，要把x做翻褶才对 就是x=【xn xn-1 ……xn-L+1】</span>
      <span class="token comment">% 但是      也可以定义“w 是做了翻褶之后的结果” 即 w = 【wL-1，wL-2，……w0】，那么 x就可以不用翻褶了</span>
      <span class="token comment">%  对于后续的影响：由于见每一句备注               </span>
      <span class="token function">y</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> w<span class="token operator">*</span><span class="token punctuation">(</span>xpad<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">% 滤波器输出   y=w*x   ，由于得到的是一个数，所以对时序没有影响</span>
      <span class="token function">e</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">y</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">% 误差信号     e=d-y   </span>
      w <span class="token operator">=</span> w <span class="token operator">+</span> mu<span class="token operator">.*</span>xpad<span class="token operator">'</span><span class="token operator">.*</span><span class="token function">e</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">% 调整滤波器系数的LMS算法 w=w+mu*x*e  ， 根据一一对应关系，没有影响，就是注意w是翻褶后的结果</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="1-4、LMS衍生算法（一）：-block-LMS-BLMS-分块最小均方算法"><a href="#1-4、LMS衍生算法（一）：-block-LMS-BLMS-分块最小均方算法" class="headerlink" title="1.4、LMS衍生算法（一）： block LMS (BLMS) 分块最小均方算法"></a>1.4、LMS衍生算法（一）： block LMS (BLMS) 分块最小均方算法</h2><ul>
<li>思想：由于标准的LMS算法 每一个采样点都进行更新，那么有一种思路就是：不必每一个采样点都进行更新，而是累积到一定数量的采样点之后再进行更新，而对于这些block采样点再更新一次滤波器系数。 这样的好处就是每一个block 获取的梯度是 一个block所有采样点梯度的求和，所以得到的梯度仍然是 真实梯度 的无偏估计 ，但是累计的采样点数更多，他的方差会更小。 </li>
<li>这种 想法与深度学习里面的minibatch的想法一致。</li>
<li>关于<strong>梯度噪声</strong>，梯度噪声的存在并非完全没有好处，梯度噪声可能会帮助我们跳出一些局部最优值，从而向全局最优的方向进行移动。</li>
</ul>
<p>用更多的采样点，更新一次滤波器系数<br>$\mathbf{w}(n+1)=\mathbf{w}(n)+2 \mu \mathbf{x}(n) e(n)$<br>$\mathbf{w}(n+2)=\mathbf{w}(n+1)+2 \mu \mathbf{x}(n+1) e(n+1)$<br>$\cdots \cdot$<br>$\mathbf{w}(n+L)=\mathbf{w}(n+L-1)+2 \mu \mathbf{x}(n+L-1) e(n+L-1)$<br>不难得出<strong>时域LMS的分块更新(block recursion)公式</strong></p>
<script type="math/tex; mode=display">\quad \mathbf{w}(n+L)=\mathbf{w}(n)+2 \mu \sum_{m=0}^{L-1} \mathbf{x}(n+m) e(n+m)</script><p>每 L 点更新一次<br>注意，式中的误差信号是通过<strong>同一个滤波器</strong> 得到的：</p>
<script type="math/tex; mode=display">e(n+m)=d(n+m)-\mathbf{x}^{T}(n+m) \mathbf{w}(n)</script><p>即$n+m$时刻（$0&lt;=m&lt;L$）的误差都是由$n$时刻的滤波器系数得到的，而不是标准LMS中的$n+m$时刻（当前时刻）<br>为了推导方便，我们通常令 L=N 也就是跟新块的长度就等于滤波器阶数。</p>
<p>与标准LMS算法相比，block LMS的更新频率降低了L倍，所以，我们定义一个新的时间索引k 来代替n。$kL=n$<br>那么上式的跟新方程可以用下式代替：</p>
<script type="math/tex; mode=display">
\mathbf{w}(k+1)=\mathbf{w}(k)+2 \mu \sum_{m=0}^{L-1} \mathbf{x}(k L+m) e(k L+m)</script><p>其中将w(kL)和w(kL+1)分别<strong>简写</strong>成w(k)和w(k＋1)。那么， block LMS的梯度其实是block中每个点的梯度求和如下</p>
<script type="math/tex; mode=display">
\hat{\nabla}(k)=-2 \sum_{m=0}^{L-1} \mathbf{x}(k L+m) e(k L+m)</script><h3 id="block-LMS-的核心运算："><a href="#block-LMS-的核心运算：" class="headerlink" title="block LMS 的核心运算："></a>block LMS 的核心运算：</h3><ul>
<li>计算误差时：<script type="math/tex; mode=display">y(n+m)=\mathbf{x}^{T}(n+m) \mathbf{w}(n)</script>就是输入向量与滤波器系数的卷积</li>
<li>计算block梯度时：<script type="math/tex; mode=display">\hat{\nabla}(k)=-2 \sum_{m=0}^{L-1} \mathbf{x}(k L+m) e(k L+m)</script>实际时输入向量与误差向量的相关</li>
</ul>
<h2 id="1-5、LMS衍生算法（二）-frequency-domain-adaptive-filtering-FDAF-频域自适应滤波"><a href="#1-5、LMS衍生算法（二）-frequency-domain-adaptive-filtering-FDAF-频域自适应滤波" class="headerlink" title="1.5、LMS衍生算法（二）:frequency-domain adaptive filtering (FDAF) 频域自适应滤波"></a>1.5、LMS衍生算法（二）:frequency-domain adaptive filtering (FDAF) 频域自适应滤波</h2><p>上一小节最后，说到BLMS核心运算就是卷积和相关。<br>但是，时域的卷积或者相关操作的复杂度时比较高的，一般我们更愿意将时域的卷积或者相关运算换算到频域（时域相关对应于频域相乘）来操作从而减少计算量，这也就是频域LMS算法的思想。</p>
<p>回顾 圆周卷积/相关 与 线性卷积/相关 的关系</p>
<p><strong>圆周卷积与线性卷积</strong></p>
<blockquote>
<p>一般的，如果两个有限长序列的长度为$N_1$和$N_2$ ，且满足$N_{1} \geqslant N_{2}$ ，则有圆周卷积的后$N_1-N_2+1$ 个点，与线性卷积的结果一致。</p>
</blockquote>
<h3 id="第一步计算线性卷积"><a href="#第一步计算线性卷积" class="headerlink" title="第一步计算线性卷积:"></a>第一步计算线性卷积:</h3><script type="math/tex; mode=display">y(n+m)=\mathbf{x}^{T}(n+m) \mathbf{w}(n)</script><p>目标利用FFT计算线性卷积。  有以下两种方案：</p>
<ul>
<li>overlap -save method （重叠保留法）</li>
<li><p>overlap -add  method  （重叠相加法）</p>
<p><strong>重叠保留法 以求BLMS求卷积部分为例</strong><br>为了得到$N$点的（线性卷积后的）输出信号：<br>以</p>
<script type="math/tex; mode=display">y(n+m)=\mathbf{x}^{T}(n+m) \mathbf{w}(n) ，m=0，1，2……N-1$$  为例，要保证至少有N个点的线性卷积与圆周卷积的结果相同：
$$N_1-N_2+1=N</script><p>由于$N_1&gt;=N_2$(也就是输入信号长度通常要大于等于滤波器阶数)，且$N_2=N$(滤波器阶数为N)，那么就要求每次参与运算的输入信号长度$N_1$至少为$2N-1$,为了FFT计算方便我们令输入长度为$N_1=2N$<br>那么FFT的点数就为$2N$</p>
</li>
</ul>
<p>如何扩展到2N长呢？</p>
<ul>
<li>对于<strong>输入信号</strong>而言， 除了当前N个采样点之外，还需要向前取N个点采样值</li>
<li>对于<strong>滤波器</strong>来说，在N阶滤波器后面补N个0 即可</li>
</ul>
<p>然后分别计算二者扩展后的<strong>傅里叶变换</strong>，<strong>频域相乘</strong>后<strong>反变换</strong> 就能得到2N长的圆周卷积</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\mathbf{X}(k)=\operatorname{diag}\{\mathbf{F}[x(k N-N), \ldots, x(k N-1), x(k N), \ldots, x(k N+N-1))]\} \\
&\mathbf{W}(k)=\mathbf{F}\left[\mathbf{w}^{T}(k), 0, \ldots, 0\right]^{T}
\end{aligned}</script><script type="math/tex; mode=display">
\mathbf{Y}(k)=\mathbf{X}(k) \mathbf{W}(k)</script><p>对于想要的N长的线性卷积，就是得到的圆周卷积的后N个点<br>$\mathbf{y}(k)=[y(k N), y(k N+1), \ldots, y(k N+N-1))]=$ last $N$ samples of $\mathbf{F}^{-1} \mathbf{Y}(k)$<br>下面就是流程框图：<br><img src="https://s2.loli.net/2022/05/14/TcoFaO6Xh9YCs3y.png" alt=""></p>
<p>注意，overlap-save方法不仅适用于频域自适应滤波，对于滤波器系数固定不变的情况依然适用。例如我们常见的语音加混响，其实就是计算纯净语音信号，与固定系数的房间冲激响应之间的线性卷积，可以使用overlap-save方法实现。</p>
<p><strong>圆周相关与线性相关</strong></p>
<blockquote>
<p>一般的，如果两个有限长序列的长度为 $N_1$和$N_2$ ，且满足$N_{1} \geqslant N_{2}$，则有圆周相关的前$N_1-N_2+1$ 个点，与线性相关的结果一致。</p>
</blockquote>
<h3 id="第二步-计算线性相关"><a href="#第二步-计算线性相关" class="headerlink" title="第二步 计算线性相关"></a>第二步 计算线性相关</h3><script type="math/tex; mode=display">
\hat{\nabla}(k)=-2 \sum_{m=0}^{L-1} \mathbf{x}(k L+m) e(k L+m)</script><p>与对卷积的操作非常类似，为了计算输入向量与误差信号之间的线性相关，我们的思路仍然是想办法将它们<strong>变换到频域</strong>，计算输入信号的<strong>共轭谱与误差信号谱的乘积</strong>，在进行<strong>逆变换</strong>到时域。</p>
<p>步骤</p>
<ul>
<li>1、获取$\mathbf{x}(k)$ ,以及其傅里叶变换 这在上一步 已获得，（所以注意这是扩展之后的长为2N的输入信号）即<script type="math/tex">\mathbf{X}(k)=\operatorname{diag}\{\mathbf{F}[x(k N-N), \ldots, x(k N-1), x(k N), \ldots, x(k N+N-1))]\}</script></li>
<li>2、扩展误差信号，对于误差信号（$\mathbf{e}(k)=[e(k N), \quad e(k N+1), \ldots, e(k N+N-1)]$）也需要将器扩展到2N长度<ul>
<li>思考：计算卷积的时候，我们将滤波器系数向量后面补N 个零。<pre><code>  那么，计算相关的时候，我们在误差向量前面补N 个零。（这是为什么？：因为圆周卷积有一个“翻褶”的操作，而圆周相关没有？）
</code></pre>并计算扩展误差信号的傅里叶变换：<script type="math/tex; mode=display">\mathbf{E}(k)=\mathbf{F}\left[0,0, \ldots, 0, \mathbf{e}^{T}(k)\right]^{T}</script></li>
</ul>
</li>
<li><p>3、将 上述 二者 频域相乘 （注意时共轭相乘）</p>
<script type="math/tex; mode=display">
\boldsymbol{\Delta}(k)=\mathbf{X}^{H}(k) \mathbf{E}(k)</script></li>
<li><p>4、取逆变换后前N点<br>对于想要的N长的线性相关，就是得到的圆周卷积的前N个点，也即</p>
<script type="math/tex; mode=display">
\vec{\nabla}(k)={[\hat{\nabla}(k N), \quad \hat{\nabla}(k N+1), \ldots, \hat{\nabla}(k N+N-1)]}=\text { first } N \text { samples of } \mathbf{F}^{-1} \boldsymbol{\Delta}(k)</script></li>
</ul>
<h3 id="第三步-滤波器系数更新"><a href="#第三步-滤波器系数更新" class="headerlink" title="第三步 滤波器系数更新"></a>第三步 滤波器系数更新</h3><p>求了上述梯度后，仅需按照时域跟新方程更新即可。至此，BLMS的连个关键问题已经被解决<br>但是，每次更新都要进行多次的时频转换，最终转换到时域进行更新，为什么不直接在频域范围里进行更新呢？这也就是频域自适应滤波frequency-domain adaptive filtering (FDAF)的思想。<br>具体而言就是把原来是时域更新方程</p>
<script type="math/tex; mode=display">
\mathbf{w}(k+1)=\mathbf{w}(k)+2 \mu \sum_{m=0}^{L-1} \mathbf{x}(k L+m) e(k L+m)</script><p>改写为：</p>
<script type="math/tex; mode=display">
\mathbf{W}(k+1)=\mathbf{W}(k)+2 \mu \mathbf{F}\left[\vec{\nabla}^{T}(k), 0,0, \ldots, 0\right]^{T}</script><p>注意：</p>
<ul>
<li>第一，滤波器系数直接在频域更新，所以需要将梯度向量再次变换到频域；</li>
<li>第二，由于滤波器系数向量后面补了N 个零(参考步骤一)，为了保证结果的正确性，梯度向量也需要在后面补N 个零。</li>
</ul>
<p>下面是frequency-domain adaptive filtering (FDAF)的总体框架图<br><img src="https://s2.loli.net/2022/05/14/qMZlsBncEGm8DTk.png" alt=""></p>
<p>可以看出FDAF技术就是在BLMSAF的基础上发展而来，本质上解决的都是同一个问题，即分块条件下的LMS滤波器梯度更新问题。</p>
<h2 id="1-6、关于LMS算法的讨论"><a href="#1-6、关于LMS算法的讨论" class="headerlink" title="1.6、关于LMS算法的讨论"></a>1.6、关于LMS算法的讨论</h2><h3 id="LMS算法对输入信号有何种要求？"><a href="#LMS算法对输入信号有何种要求？" class="headerlink" title="LMS算法对输入信号有何种要求？"></a>LMS算法对输入信号有何种要求？</h3><script type="math/tex; mode=display">
\mathbf{w}(n+1)=\mathbf{w}(n)+2 \mu \mathbf{x}(n) e(n)</script><p>LMS要求不同时刻输入的向量$\mathbf{x}(n)$线性无关————这是<code>LMS的独立性假设</code>,如果如输入信号存在相关性，会导致<strong>前一时刻迭代产生的梯度噪声传播到下一次迭代</strong>，造成误差的反复传播，收敛速度慢，跟踪性能变差。</p>
<p>所以理论上，LMS算法对白噪声的效果最好。</p>
<p>对于带有相关噪声的输入信号，如语音信号，有相应的“解相关LMS算法”。</p>
<h3 id="归一化LMS（NLMS），功率归一化LMS（PNLMS-）"><a href="#归一化LMS（NLMS），功率归一化LMS（PNLMS-）" class="headerlink" title="归一化LMS（NLMS），功率归一化LMS（PNLMS ）"></a>归一化LMS（NLMS），功率归一化LMS（PNLMS ）</h3><p><strong>NLMS</strong><br>本质上是一个东西，只不过在更新方程中，除以了一个用于归一化的因子$\mathbf{x}^{T}(n) \mathbf{x}(n)$</p>
<script type="math/tex; mode=display">
\mathbf{w}(n+1)=\mathbf{w}(n)+2 \mu \frac{\mathbf{x}(n)}{\mathbf{x}^{T}(n) \mathbf{x}(n)} e(n)</script><p>思想是：对于较大的输入，会导致梯度噪声的放大，因此需要用输入向量的平方范数进行归一化。</p>
<p><strong>PNLMS</strong><br>功率归一下LMS是NLMS的改进，它对调整步长进行改写，</p>
<script type="math/tex; mode=display">
\mu(n)=\frac{\alpha}{\beta+\mathbf{x}^{T}(n) \mathbf{x}(n)}, \quad 0<\alpha<2, \quad \beta \geqslant 0</script><p>功率归一化LMS（PNLMS）是利用归一化项 $\mathbf{x}^{T}(n) \mathbf{x}(n)$调整学习速率，数值稳定性要好于NLMS。当$\alpha=1$ 时，PNLMS退化为NLMS。</p>
<h3 id="频域自适应滤波-学习速率的选取"><a href="#频域自适应滤波-学习速率的选取" class="headerlink" title="频域自适应滤波 学习速率的选取"></a>频域自适应滤波 学习速率的选取</h3><script type="math/tex; mode=display">
\mathbf{W}(k+1)=\mathbf{W}(k)+2 \mu \mathbf{F}\left[\vec{\nabla}^{T}(k), 0,0, \ldots, 0\right]^{T}</script><p>我们在推导频域自适应滤波方法的时候，为了简化问题，将每一个frequency bin上的学习速率均设为常数$\mu$。<br>在实际工程应用中，用的更多的一种方法是，对第m 个frequency bin，利用输入信号在这个<strong>频点</strong>的功率$P_m(k)$对学习速率进行归一化：(和时域LMS归一化思想一致)</p>
<script type="math/tex; mode=display">
\mu_{m}(k)=\frac{\mu}{P_{m}(k)}</script><p>频点功率$P_m(k)$通常采用迭代的方式求得</p>
<script type="math/tex; mode=display">
P_{m}(k)=\lambda P_{m}(k-1)+(1-\lambda)\left|X_{m}(k)\right|^{2}</script><h4 id="关于期望信号-d-n）"><a href="#关于期望信号-d-n）" class="headerlink" title="关于期望信号$d(n）$"></a>关于期望信号$d(n）$</h4><p>LMS算法中我们已知的有输入信号$x$,和预测输出信号$y$，实际情况下是不知道期望输出的，如果知道了期望输出那么就没有进行滤波的必要了。因此需要用一些方法来估计期望输出，   具体而言，期望输出可以用以下几种方法获取。<a target="_blank" rel="noopener" href="https://www.it610.com/article/1290594719520333824.htm">出处</a></p>
<ul>
<li>1、使用延迟后的输入信号作为参考信号$d$，即$d(n) = x(n-i)$，其中i为延迟量,可正可负（用于自适应预测）</li>
<li>2、期望信号为信号与噪声之和，即$d(n) = x(n) + s(n)$,其中$s(n)$为训练时使用的噪声（用于自适应干扰抵消器，需要噪声与输入信号不相关）</li>
<li>3、直接用输出代替期望信号，即$d(n) = x(n)$</li>
<li>4、从$x(n)$中估计$d(n)$ ，$d(n) = y(n) + v(n)$,其中$v(n) = w(n)-wo$ ,$wo$是维纳滤波器的最优权值。具体见维纳滤波(感觉很离谱啊，求维纳滤波你也得需要期望信号啊)</li>
</ul>
<p>其实这一部分在matlab 官方教程 <a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/dsp/ug/overview-of-adaptive-filters-and-applications.html">自适应滤波以及应用概述</a> 里面的就有，讲得十分透彻.</p>
<h1 id="二、RLS-滤波器（Recursive-Least-Square）递归最小二乘算法"><a href="#二、RLS-滤波器（Recursive-Least-Square）递归最小二乘算法" class="headerlink" title="二、RLS 滤波器（Recursive Least Square）递归最小二乘算法"></a>二、RLS 滤波器（Recursive Least Square）递归最小二乘算法</h1><h2 id="2-1、回顾与思路"><a href="#2-1、回顾与思路" class="headerlink" title="2.1、回顾与思路"></a>2.1、回顾与思路</h2><p>最小均方误差准则（MMSE）</p>
<script type="math/tex; mode=display">
J(\mathbf{w})=E\left\{|e(n)|^{2}\right\}=E\left\{\left|d(n)-\mathbf{w}^{T}(n) \mathbf{x}(n)\right|^{2}\right\}</script><p>前面也说过，这种求“期望”的方案非常不好求，与LMS算法一样，RLS也想把期望符号去掉再来更新滤波器系数，而它去期望的方案是把把均方误差改成 求误差的平方和。即</p>
<script type="math/tex; mode=display">
J(\mathbf{w})=\sum_n|e(n)|^{2}</script><p>其实,与LMS的代价准则等价，是对所有时刻（所有历史时刻）的误差进行“均匀加权的结果”，也就是无论 某时刻 距离当前时刻的距离有多远，这一时刻对当前评价准则$J(\mathbf{w})$的贡献 权重 是相同的。这也可以称之为“均匀加权函数”</p>
<p>这种均匀加权的策略对于平稳过程当然不错，但是对于语音信号这种非平稳过程就不太友好了。那么就有这样一种想法，既然是非平稳的过程，那么我希望对于里当前时刻越近的时间点，他对评价指标的影响越大，也就是给他的加权越重，反之，越轻。</p>
<h2 id="2-2、新的误差准则"><a href="#2-2、新的误差准则" class="headerlink" title="2.2、新的误差准则"></a>2.2、新的误差准则</h2><p>采用指数加权的定义方式，调整目标函数为：</p>
<script type="math/tex; mode=display">
J_{n}(\mathbf{w})=\sum_{i=0}^{n} \lambda^{n-i}|e(i)|^{2}=\sum_{i=0}^{n} \lambda^{n-i}\left|d(i)-\mathbf{w}^{T}(n) \mathbf{x}(i)\right|^{2}</script><p>其中，n为“当前时刻”，i为遍历的“历史时刻”，$0&lt;\lambda \leq1$为“遗忘因子”。</p>
<p>遗忘因子的作用是对离 n 时刻越近的误差加比较大的权重，而对离 n 时刻越远的误差加比较小的权<br>重，也就是说对各个时刻的误差具有一定的遗忘作用。<br>如果$\lambda=1$表示无任何遗忘功能，或具有无穷记忆功能，此时RLS退化为LS方法。<br>如果$\lambda-&gt;0$表示只有当前时刻的误差起作用，而过去时刻的误差完全被遗忘。</p>
<p>另外 特别注意：</p>
<blockquote>
<p>对于误差的定义： 用的是$|e(i)|=\left|d(i)-\mathbf{w}^{T}(n) \mathbf{x}(i)\right|$而不是 $|e(i)|=\left|d(i)-\mathbf{w}^{T}(i) \mathbf{x}(i)\right|$。<br>通俗点来说就是，对于$i$时刻（先前时刻）的误差，用的是$n$时刻滤波器的系数来估算的，而不是$i$时刻，也就是所谓的“后验误差”。 原因呢是：我们认为 在自适应更新过程中，滤波器总是变得越来越好，这意味着对于任何的 $i&lt;n$, 总认为$\left|d(i)-\mathbf{w}^{T}(n) \mathbf{x}(i)\right|&lt;\left|d(i)-\mathbf{w}^{T}(i) \mathbf{x}(i)\right|$，<br>这其实是一个比较主观的决定，实际工程当中，采用先验误差还是后验误差差别其实非常小，因为一旦滤波器的系数收敛，采用哪种方式来定义误差差距并不是很大。并且，采用后验误差运算量，占用内存上其实更小一些。</p>
</blockquote>
<h2 id="2-3、RLS算法-推导"><a href="#2-3、RLS算法-推导" class="headerlink" title="2.3、RLS算法 推导"></a>2.3、RLS算法 推导</h2><p>同样的，让$J_{n}(\mathbf{w})$的对w求导，令梯度为0，得到</p>
<script type="math/tex; mode=display">
\mathbf{w}(n)=\mathbf{R}^{-1}(n) \mathbf{r}(n)</script><p>其中，</p>
<script type="math/tex; mode=display">
\mathbf{R}(n)=\sum_{i=0}^{n} \lambda^{n-i} \mathbf{x}(i) \mathbf{x}^{T}(i) \\
\mathbf{r}(n)=\sum_{i=0}^{n} \lambda^{n-i} \mathbf{x}(i) d(i)</script><p>这依然是加权意义下的“维纳解”</p>
<p>此外，对于相关矩阵$\mathbf{R}(n)$与相关向量$\mathbf{r}(n)$有如下递推关系。</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{R}(n) &=\lambda \mathbf{R}(n-1)+\mathbf{x}(n) \mathbf{x}^{T}(n) \\
\mathbf{r}(n) &=\lambda \mathbf{r}(n-1)+\mathbf{x}(n) d(n)
\end{aligned}</script><p>看起来只要知道上一时刻的相关矩阵和相关向量，再利用递推公式就能完整地构建改进型的维纳滤波器，步骤如下。<br><img src="https://s2.loli.net/2022/05/20/pOQJDSgcBN2udqx.png" alt=""><br>其实，这样的思想是可以，但计算量太大了，计算量主要在于求<strong>相关矩阵的逆</strong>的过程，每一步都要求，这样计算量太大了。</p>
<p>如果将相关矩阵的逆设为矩阵$\mathbf P(n)=\mathbf R^{-1}(n)$,那么能否直接得到$\mathbf P(n)$<strong>矩阵的递推公式</strong>，从而<strong>避免矩阵求逆的运算</strong>呢？</p>
<p>推导如下：</p>
<script type="math/tex; mode=display">
\mathbf{P}(n)=\mathbf{R}^{-1}(n)=\left(\lambda \mathbf{R}(n-1)+\mathbf{x}(n) \mathbf{x}^{T}(n)\right)^{-1}</script><p>由矩阵求逆引理</p>
<script type="math/tex; mode=display">
(A+B C D)^{-1}=A^{-1}-A^{-1} B\left(C^{-1}+D A^{-1} B\right)^{-1} D A^{-1}</script><p>现令</p>
<script type="math/tex; mode=display">
A=\mathbf{R}(n-1) \quad B=\mathbf{x}(n) \quad C=\frac{1}{\lambda} \quad D=\mathbf{x}^{T}(n)</script><p>就能得到</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{P}(n) &=\frac{1}{\lambda}\left[\mathbf{P}(n-1)-\frac{\mathbf{P}(n-1) \mathbf{x}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1)}{\lambda+\mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{x}(n)}\right] \\
&=\frac{1}{\lambda}\left[\mathbf{P}(n-1)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1)\right]
\end{aligned}</script><p>其中，我们称$\mathbf{k}(n)$为<strong>增益向量</strong></p>
<script type="math/tex; mode=display">
\mathbf{k}(n)=\frac{\mathbf{P}(n-1) \mathbf{x}(n)}{\lambda+\mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{x}(n)}</script><p>ok，我们现在得到了$\mathbf P(n)$的递推公式，那么仅需与相关向量相乘就能得到最优滤波器系数向量了。<br>即</p>
<script type="math/tex; mode=display">
\mathbf{w}(n)=\mathbf{R}^{-1}(n) \mathbf{r}(n) =\mathbf{P}(n) \mathbf{r}(n)</script><p>带进最优滤波器系数向量公式，得到滤波器更新公式 也即<strong>RLS算法更新公式</strong>：</p>
<script type="math/tex; mode=display">
\mathbf{w}(n)=\mathbf{w}(n-1)+\mathbf{k}(n) \varepsilon(n)\\
\varepsilon(n)=d(n)-\mathbf{x}^{T}(n) \mathbf{w}(n-1)</script><p>（$ \varepsilon(n)$为<strong>先验估计误差误差</strong>）</p>
<p>推导过程</p>
<blockquote>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{w}(n)=& \mathbf{R}^{-1}(n) \mathbf{r}(n)=\mathbf{P}(n) \mathbf{r}(n) \\
=& \frac{1}{\lambda}\left[\mathbf{P}(n-1)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1)\right][\lambda \mathbf{r}(n-1)+\mathbf{x}(n) d(n)] \\
=& \mathbf{P}(n-1) \mathbf{r}(n-1)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{r}(n-1) \\
&+\frac{1}{\lambda} d(n)\left[\mathbf{P}(n-1) \mathbf{x}(n)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{x}(n)\right]   \quad  （这一行具体的变换见下面）\\
=& \mathbf{w}(n-1)+d(n) \mathbf{k}(n)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{w}(n-1) \\
=& \mathbf{w}(n-1)+\mathbf{k}(n)\left[d(n)-\mathbf{x}^{T}(n) \mathbf{w}(n-1)\right] \\
=& \mathbf{w}(n-1)+\mathbf{k}(n) \varepsilon(n)\quad
\end{aligned}</script><p>中间一步的推导：</p>
<script type="math/tex; mode=display">
\frac{1}{\lambda}\left[\mathbf{P}(n-1) \mathbf{x}(n)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{x}(n)\right]（根据增益向量 将第一项变形） \\
=\frac{1}{\lambda}\left\{\left[\lambda+\mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{x}(n)\right] \mathbf{k}(n)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{x}(n)\right\} \\
=\mathbf{k}(n)</script></blockquote>
<h2 id="2-4、标准RLS算法执行流程"><a href="#2-4、标准RLS算法执行流程" class="headerlink" title="2.4、标准RLS算法执行流程"></a>2.4、标准RLS算法执行流程</h2><p>初始化RLS算法执行步骤：</p>
<blockquote>
<p>1）初始化：<br>$\mathbf{w}(0)=\mathbf{0}$、$\mathbf{P}(0)=\delta^{-1}\mathbf{I}$、$\delta$是一个很小的正数,<br>PS:$\mathbf{P}(0)$的取法有点“讲头”的，首先R(0)是一个相关矩阵，所以是一个对称阵，另外为了方便求逆，所以取单位阵，其次，之前也说了，RLS的误差准则是，离当前时刻越远，其影响对当前时刻越小越好，所以，给他乘一个很小的系数。<br>2）对于每一个时刻n，重复下面的计算：<br>  $\quad$ 先验误差：$\varepsilon(n)=d(n)-\mathbf{x}^{T}(n) \mathbf{w}(n-1)$<br>  $\quad$ 增益向量：$\mathbf{k}(n)=\frac{\mathbf{P}(n-1) \mathbf{x}(n)}{\lambda+\mathbf{x}^{T}(n) \mathbf{P}(n-1) \mathbf{x}(n)}$<br>  $\quad$ 逆矩阵更新： $\mathbf{P}(n)=\frac{1}{\lambda}\left[\mathbf{P}(n-1)-\mathbf{k}(n) \mathbf{x}^{T}(n) \mathbf{P}(n-1)\right]$<br>  $\quad$ 滤波器更新：$\mathbf{w}(n)=\mathbf{w}(n-1)+\mathbf{k}(n) \varepsilon(n)$</p>
</blockquote>
<p><strong>代码实现</strong><br><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab"><span class="token keyword">function</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span>e<span class="token punctuation">,</span>w<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">MyRLS</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span>lambda<span class="token punctuation">,</span>x<span class="token punctuation">,</span>d<span class="token punctuation">)</span>
<span class="token comment">% 输入参数</span>
<span class="token comment">% L 滤波器阶数</span>
<span class="token comment">% lambda 遗忘因子; lambda=1，表示“不遗忘”，等价于LS ，Lambda=0表示除了当前，全部遗忘 默认 lambda=0.98</span>
<span class="token comment">% x 输入信号; 是指 直接进入滤波器于滤波器系数相卷积的那一路</span>
<span class="token comment">% d 期望信号：是指 不进入滤波器，而只作为“参考”，产生误差信号的那一路</span>
<span class="token comment">% output 输出：是指滤波器的直接输出</span>
<span class="token comment">% w 滤波器系数： </span>
<span class="token comment">% 注意 输入信号于期望 输入应该保证一样长</span>

N<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">% 总输入长度</span>

<span class="token comment">% 初始化</span>
w <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">% 行向量</span>
delta<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">;</span>                    
P<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>delta<span class="token operator">*</span><span class="token function">eye</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span>L<span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token comment">% 初始化的 相关矩阵的逆矩阵</span>
e<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
y<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>   
k<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>

x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> x<span class="token operator">'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">%  行向量  </span>
  <span class="token keyword">for</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>N  <span class="token comment">% 每一个采样点“前进一步”</span>
      m <span class="token operator">=</span> n <span class="token operator">+</span> L <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">% n是“起始点”，m则是“结束点”</span>
      
      xpad <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span>m<span class="token operator">-</span>L<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>m<span class="token punctuation">)</span><span class="token operator">'</span><span class="token punctuation">;</span>	     <span class="token comment">% 列向量  ：   </span>
      <span class="token comment">%关于x是否应该“翻褶”这一点已经在LMS 那个程序里面 说过一遍，结论就是：只要对应好，就没必要翻褶，但是输出的w应该是倒序输出</span>
      <span class="token function">y</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> w<span class="token operator">*</span><span class="token punctuation">(</span>xpad<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">% 滤波器输出   y=w*x  </span>
      <span class="token function">e</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">y</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">% 误差信号     e=d-y  是一个数</span>
      <span class="token comment">% 求增益向量</span>
      <span class="token comment">%k=P*xpad/(lambda+xpad'*R*xpad)          这一步由于 求 了两次 P*xpad，可以优化为</span>
      k<span class="token operator">=</span>P<span class="token operator">*</span>xpad<span class="token punctuation">;</span>
      k<span class="token operator">=</span>k<span class="token operator">/</span><span class="token punctuation">(</span>lambda<span class="token operator">+</span>xpad<span class="token operator">'</span><span class="token operator">*</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">% 列向量   </span>

      <span class="token comment">% 更新逆矩阵</span>
      P<span class="token operator">=</span><span class="token punctuation">(</span>P<span class="token operator">-</span>k<span class="token operator">*</span>xpad<span class="token operator">'</span><span class="token operator">*</span>P<span class="token punctuation">)</span><span class="token operator">/</span>lamda<span class="token punctuation">;</span>    
      <span class="token comment">% 滤波器系数更新</span>
      w <span class="token operator">=</span> w <span class="token operator">+</span> k<span class="token operator">'</span><span class="token operator">*</span> <span class="token function">e</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>         
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="2-5-RLS-与LMS-对比"><a href="#2-5-RLS-与LMS-对比" class="headerlink" title="2.5 RLS 与LMS 对比"></a>2.5 RLS 与LMS 对比</h2><p>一个广泛的共识是，RLS算法的收敛速度和跟踪性能都优于LMS算法，所付出的代价是需要<br>更复杂的计算。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">算法</th>
<th style="text-align:center">LMS</th>
<th style="text-align:center">RLS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">计算误差</td>
<td style="text-align:center">后验误差</td>
<td style="text-align:center">先验误差</td>
</tr>
<tr>
<td style="text-align:center">收敛速度</td>
<td style="text-align:center">慢</td>
<td style="text-align:center">快</td>
</tr>
<tr>
<td style="text-align:center">跟踪性能</td>
<td style="text-align:center">慢</td>
<td style="text-align:center">快</td>
</tr>
<tr>
<td style="text-align:center">计算代价</td>
<td style="text-align:center">小</td>
<td style="text-align:center">大</td>
</tr>
</tbody>
</table>
</div>
<p>另外，由于RLS使用了自相关矩阵的逆矩阵的递推，所以，一旦<strong>输入信号的自相关矩阵接近奇异时</strong>（输入信号各个时刻不要“太相关”），RLS的收敛速度和跟踪性能会严重恶化。</p>
<p>可以看到，LMS 算法 与RLS 算法 在各个方面走了<strong>两个极端</strong>，下面要讲的 仿射投影算法可以说是两种“极端”的折中，也可以说是包含二者的一种统一框架。</p>
<h1 id="三、APA（Affine-Projection-algorithm）仿射投影算法"><a href="#三、APA（Affine-Projection-algorithm）仿射投影算法" class="headerlink" title="三、APA（Affine Projection algorithm）仿射投影算法"></a>三、APA（Affine Projection algorithm）仿射投影算法</h1><h2 id="3-1、再次从一个N阶系统-mathbf-w-n-出发…-新的框架"><a href="#3-1、再次从一个N阶系统-mathbf-w-n-出发…-新的框架" class="headerlink" title="3.1、再次从一个N阶系统$\mathbf{w(n)}$出发…(新的框架)"></a>3.1、再次从一个N阶系统$\mathbf{w(n)}$出发…(新的框架)</h2><p>考虑一个N阶系统$w(n)$ ，<br>这一次我们将构造一个更加通用的模型，首先输入、输出、权重 都可以是复数</p>
<script type="math/tex; mode=display">
y(n)=\mathbf{w}^{H}(n) \mathbf{x}(n)=\mathbf{x}^{T}(n) \mathbf{w}^{*}(n)</script><p>N阶系统（n阶滤波器）n时刻的滤波器系数为，</p>
<script type="math/tex; mode=display">\mathbf{w}(n)=\left[\begin{array}{llll}w_{0}(n), & w_{1}(n), & \ldots & w_{N-1}(n)\end{array}\right]^{T}</script><p>如果将 滤波器原本滤波器当前的输出扩展成一组向量 。向量内容 为滤波器最近的L个输出为：</p>
<script type="math/tex; mode=display">y(n)-->\mathbf{y}(n)=[y(n), \quad y(n-1), \quad \ldots \quad y(n-L+1)]^{T}</script><p>那么，相应的输入也得改变，将是一个矩阵 N*L的矩阵，<br>从原来的</p>
<script type="math/tex; mode=display">\mathbf{x}(n)=[x(n), \quad x(n-1), \quad \ldots \quad x(n-N+1)]^{T}</script><p>扩展为</p>
<script type="math/tex; mode=display">\mathbf{X}(n)=[\mathbf{x}(n), \quad \mathbf{x}(n-1), \quad \ldots \quad \mathbf{x}(n-L+1)]</script><p>也即，展开来写</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{X}(n) &=[\mathbf{x}(n), \mathbf{x}(n-1), \cdots \cdots, \mathbf{x}(n-L+1)] \\
&=\left[\begin{array}{ccccc}
x(n) & x(n-1) & x(n-2) & \cdots & x(n-L+1) \\
x(n-1) & x(n-2) & x(n-3) & \cdots & x(n-L) \\
x(n-2) & x(n-3) & x(n-4) & \cdots & x(n-L-1) \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
x(n-N+1) & x(n-N) & x(n-L-1) & \cdots & x(n-N-L+2)
\end{array}\right]
\end{aligned}</script><p>平行于斜对角线元素的行相等<br>这是一个广义上的Hankel 矩阵，可以看看 <a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/matlab/ref/hankel.html">matlab 教程</a>，注意与 toplize矩阵相区分。</p>
<p>此时滤波器输出变成了</p>
<script type="math/tex; mode=display">
\mathbf{y}(n)=\mathbf{X}^{T}(n)\mathbf{w}^{*}(n)</script><h2 id="3-2、滤波器更新策略？"><a href="#3-2、滤波器更新策略？" class="headerlink" title="3.2、滤波器更新策略？"></a>3.2、滤波器更新策略？</h2><p>若令滤波器更新公式为：</p>
<script type="math/tex; mode=display">
\mathbf{w}(n)=\mathbf{w}(n-1)+\mu \Delta \mathbf{w}_n</script><p>将更新后的滤波器系数带入到滤波器输出公式当中</p>
<script type="math/tex; mode=display">
\mathbf{y}(n)=\mathbf{X}^{T}(n) \mathbf{w}^{*}(n-1)+\mu \mathbf{X}^{T}(n) \Delta \mathbf{w}_{n}^{*}</script><p>公式的前一项是当前输入矩阵进入前一时刻滤波器输出的结果，这肯定与当前时刻滤波器有一定误差，我们将第二项整体 定义为“<strong>先验误差向量</strong>”，</p>
<script type="math/tex; mode=display">
\mathbf{e}(n)=\mu \mathbf{X}^{T}(n) \Delta \mathbf{w}_{n}^{*}=\mathbf{y}(n)-\mathbf{X}^{T}(n) \mathbf{w}^{*}(n-1)</script><p>由于$\mu$仅仅是一个可变的“学习率”，对结构来说并不太重要，我们将其简化 令其等于1，也即$\mathbf{e}(n)=\mathbf{X}^{T}(n) \Delta \mathbf{w}_{n}^{*}$ 或</p>
<script type="math/tex; mode=display">\mathbf{X}^{H}(n) \Delta \mathbf{w}_{n}=\mathbf{e}^*(n)</script><p>可以发现 这种形式与线性代数中学到的线性方程组($\mathbf{A}\mathbf{x}=\mathbf{b}$)一致,它由L个（行）N元线性方程决定。<br>而这个线性方程组的解（即$ \Delta \mathbf{w}_{n}$）,就是我们想要的“<strong>滤波器更新策略</strong>”，那么只要求解这个N元方程组即可得到更新策略了。</p>
<p>补充知识(求解线性方程组的相关背景知识)：</p>
<blockquote>
<p>对于线性方程组：$\mathbf{A}_{m\times n}\mathbf{x}_{n \times 1}=\mathbf{b}_{m \times 1}$<br>只考虑<strong>行满秩</strong>的情况下：<br>1）：$m=n$，则<script type="math/tex">\mathbf{x}=\mathbf{A}^{-1}b</script>是唯一解，而且是精确解<br>2）：$m&lt;n$, 方程数小于未知数个数，也叫欠定方程组 ，将有无穷解（有$n-rank(A)$个解系）(可以将每一个方程理解为一个约束条件，那么约束条件越少，解(解系)“越多”)。但是我们为了得到一个确定的解，添加一些约束条件，在$\mathbf{x}$的范数最小，也即$min{\{norm(\mathbf{x})\}}$ 的这一约束下 有唯一解，叫做“<strong>最小范数解</strong>”</p>
<script type="math/tex; mode=display">
\mathbf{x}=\mathbf{A}^{H}(\mathbf{A}\mathbf{A}^{H})^{-1}b</script><p>可以把$\mathbf{A}^{H}(\mathbf{A}\mathbf{A}^{H})^{-1}$ 视为$\mathbf{A}$ 的‘逆矩阵’，只不过这个矩阵作用在$\mathbf{A}$ 的左边。即$\mathbf{A}\mathbf{A}^{H}(\mathbf{A}\mathbf{A}^{H})^{-1}=\mathbf{E} $<br>3）：$m&gt;n$, 方程数大于未知数个数，也叫超定方程组，线性代数理论中是无解的，更进一步扩展的话只能叫“没有精确解”，事实上，我们可以找到一个近似的解，让等式两边的误差平方尽可能的小，也即最小化$min{\{norm(\mathbf{Ax-b})\}}$条件下，即”<strong>最小二乘解</strong>“</p>
<script type="math/tex; mode=display">
\mathbf{x}=(\mathbf{A}^{H}\mathbf{A})^{-1}\mathbf{A}^{H}b</script><p>可以把$(\mathbf{A}\mathbf{A}^{H})^{-1}\mathbf{A}^{H}$ 视为$\mathbf{A}$ 的‘逆矩阵’，只不过这个矩阵作用在$\mathbf{A}$ 的右边。即$(\mathbf{A}\mathbf{A}^{H})^{-1}\mathbf{A}\mathbf{A}^{H}=\mathbf{E} $<br>在矩阵论当中，这些逆矩阵可以有一个统一的称呼 叫做“<strong>广义逆矩阵</strong>” 合并写为$\mathbf{A}^{\dagger}$,<br>那么，矩阵的解可以统一写为</p>
<script type="math/tex; mode=display">
\mathbf{x}=\mathbf{A}^{\dagger}b</script><p>知乎：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/503664717">https://zhuanlan.zhihu.com/p/503664717</a></p>
</blockquote>
<p>根据上述线性方程组的结论，重新审视方程$\mathbf{X}^{H}(n) \Delta \mathbf{w}_{n}=\mathbf{e}^*(n)$</p>
<ul>
<li><p><strong>情况一</strong>：当，$1\leq L &lt;N $,方程数小于未知数，方程为欠定方程组，具有唯一最小范数解：</p>
<script type="math/tex; mode=display">
\Delta \mathbf{w}_{n}=\mathbf{X}(n)\left(\mathbf{X}^{H}(n) \mathbf{X}(n)\right)^{-1} \mathbf{e}^{*}(n)</script><p>此时，自适应算法变为：</p>
<script type="math/tex; mode=display">
\mathbf{w}(n)=\mathbf{w}(n-1)+\mu \Delta \mathbf{w}_n=\mathbf{w}(n-1)+\mu \mathbf{X}(n)\left(\mathbf{X}^{H}(n) \mathbf{X}(n)\right)^{-1} \mathbf{e}^{*}(n)</script><p>当$L=1$时，将退化为NLMS算法，即</p>
<script type="math/tex; mode=display">
\mathbf{w}(n+1)=\mathbf{w}(n)+ \mu \frac{\mathbf{x}(n)}{\mathbf{x}^{T}(n) \mathbf{x}(n)} e(n)</script><p>对比上面的NLMS 只是学习率有有变化，其实没有本质上的区别。<br>实际当中，对于这种方程，L一般取2、3就足够了。</p>
</li>
<li><p><strong>情况二</strong>： 当$L \geq N$s时，方程数大于为质数个数，方程为超定方程，具有唯一最小二乘解：</p>
<script type="math/tex; mode=display">
\Delta \mathbf{w}_{n}=\left(\mathbf{X}(n) \mathbf{X}^{H}(n)\right)^{-1} \mathbf{X}(n) \mathbf{e}^{*}(n)</script><p>此时，自适应算法变为：</p>
<script type="math/tex; mode=display">
\mathbf{w}(n)=\mathbf{w}(n-1)+\mu\left(\mathbf{X}(n) \mathbf{X}^{H}(n)\right)^{-1} \mathbf{X}(n) \mathbf{e}^{*}(n)</script><p>如果我们令$\mu=1$ ， $\mathbf{R}(n)=\frac{1}{L} \mathbf{X}(n) \mathbf{X}^{H}(n) $,   $\mathbf{r}(n)=\frac{1}{L} \mathbf{X}(n) \mathbf{y}^{<em>}(n)$,   并结合等式 $ \mathbf{e}(n)=\mu \mathbf{X}^{T}(n) \Delta \mathbf{w}_{n}^{</em>}=\mathbf{y}(n)-\mathbf{X}^{T}(n) \mathbf{w}^{*}(n-1) $  ，可得：</p>
<script type="math/tex; mode=display">
\begin{aligned}
\mathbf{w}(n) &=\mathbf{w}(n-1)+\left(\mathbf{X}(n) \mathbf{X}^{H}(n)\right)^{-1} \mathbf{X}(n)\left(\mathbf{y}^{*}(n)-\mathbf{X}^{H}(n) \mathbf{w}(n-1)\right) \\
&=\mathbf{w}(n-1)+\mathbf{R}^{-1}(n) \mathbf{r}(n)-\mathbf{R}^{-1}(n) \mathbf{R}(n) \mathbf{w}(n-1)
\end{aligned}</script><p>等价于RLS(递推最小二乘算法)（PS：RLS算法中$\mathbf{w}(n)=\mathbf{R}^{-1}(n) \mathbf{r}(n) $，相当于省略了所有的$\mathbf{w}(n-1)$项）</p>
</li>
</ul>
<p><strong>代码实现</strong><br><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab"><span class="token keyword">function</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span>e<span class="token punctuation">,</span>w<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">MyAPA</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span>P<span class="token punctuation">,</span>x<span class="token punctuation">,</span>d<span class="token punctuation">)</span>
<span class="token comment">% 输入参数：</span>
<span class="token comment">% L：滤波器阶数</span>
<span class="token comment">% P: 重用次数</span>
<span class="token comment">% x；输入信号</span>
<span class="token comment">% d：期望信号</span>
<span class="token comment">% 输出参数：</span>
<span class="token comment">% y：输出信号</span>
<span class="token comment">% e：误差信号</span>
<span class="token comment">% w： 滤波器系数</span>

<span class="token comment">% 注意 输入信号于期望 输入应该保证一样长</span>

N<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">% 总输入长度</span>

<span class="token comment">% 初始化</span>
w <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">% 行向量                  </span>

e<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>    
y<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>   
k<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>

Y<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>L <span class="token operator">+</span>P<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> x<span class="token operator">'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">%  行向量  </span>
d <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>P<span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  d<span class="token operator">'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>N  <span class="token comment">% 每一个采样点“前进一步”</span>
      m <span class="token operator">=</span> n <span class="token operator">+</span> L <span class="token operator">+</span> P <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>            <span class="token comment">% n是“起始点”，m则是“结束点”</span>
      
      Xpad <span class="token operator">=</span> <span class="token function">hankel</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span>n<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">(</span>n<span class="token operator">+</span>L<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token operator">+</span>L<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	        <span class="token comment">% 输入矩阵， L*P列</span>
      <span class="token comment">% 关于 时序问题，可以意LMS的代码为例，看看是否正确 </span>
      ypad<span class="token operator">=</span><span class="token function">conj</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token operator">*</span>Xpad<span class="token punctuation">;</span>              <span class="token comment">% 行向量 1*P 与x 一样 与定义的时序相反</span>

      dpad<span class="token operator">=</span><span class="token function">d</span><span class="token punctuation">(</span>n<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">(</span>n<span class="token operator">+</span>P<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">% 行向量</span>
      epad<span class="token operator">=</span>ypad<span class="token operator">-</span>dpad<span class="token punctuation">;</span>                 <span class="token comment">% 误差   e=d-y 是一个向量</span>

      <span class="token comment">% 求</span>
      <span class="token comment">% 求增益向量</span>
      <span class="token comment">%k=P*xpad/(lambda+xpad'*R*xpad)          这一步由于 求 了两次 P*xpad，可以优化为</span>
      k<span class="token operator">=</span>P<span class="token operator">*</span>xpad<span class="token punctuation">;</span>
      k<span class="token operator">=</span>k<span class="token operator">/</span><span class="token punctuation">(</span>lambda<span class="token operator">+</span>xpad<span class="token operator">'</span><span class="token operator">*</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">% 列向量   </span>

      <span class="token comment">% 更新逆矩阵</span>
      P<span class="token operator">=</span><span class="token punctuation">(</span>P<span class="token operator">-</span>k<span class="token operator">*</span>xpad<span class="token operator">'</span><span class="token operator">*</span>P<span class="token punctuation">)</span><span class="token operator">/</span>lamda<span class="token punctuation">;</span>    
      <span class="token comment">% 滤波器系数更新</span>
      w <span class="token operator">=</span> w <span class="token operator">+</span> k<span class="token operator">'</span><span class="token operator">*</span> <span class="token function">e</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>         
<span class="token keyword">end</span>


<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>AP算法：</p>
<ul>
<li>仿射投影算法提供了一套自适应滤波分析的统一框架，这套框架将LMS、AP、RLS三种算<br>法串联在一起。</li>
<li>AP算法是计算复杂度和性能介于LMS和RLS之间的自适应算法，在AEC、multi-channel等<br>场景中都有应用。可以根据实际项目中对计算复杂度、收敛速度的要求，选择合适的自适应算法，解决<br>自身场景的问题。</li>
<li>其实RLS、AP算法都有各自的快速算法，可以提高收敛速度或减少计算量</li>
</ul>
<p>总结：</p>
<ul>
<li>维纳滤波：<br> 平稳环境、最小均方意义下的统计最优滤波器，理论意义大于实际意义。而且他并非自适应滤波器算法（不会动态跟踪），因为它整体意义下的最优（要 求 一系列期望）</li>
<li>最小均方（族）自适应滤波器 <ul>
<li>LMS滤波器 (标准LMS)</li>
<li>分块LMS滤波器 BLMS</li>
<li>归一化LMS滤波器 NLMS</li>
<li>频域自适应滤波器 FDAF</li>
<li>子带自适应滤波器 </li>
<li>等等</li>
</ul>
</li>
<li>递归最小二乘（族）自适应滤波器<ul>
<li>RLS滤波器，收敛速度更快，但是计算复杂度高</li>
</ul>
</li>
<li>放射投影自适应滤波器<ul>
<li>各种性能介于以上二者之间，更重要的，它提供了一个统一的框架</li>
</ul>
</li>
</ul>
<p>补充，自适应滤波“家族”其实还有一个重要成员，卡尔曼滤波器， 它是一种基于状态转移原理的一种滤波器，并且，RLS算法滤波器也可以视为 卡尔曼滤波器的一种具体实现形式。</p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/donate/AliPayQR.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2022/05/16/%E3%80%8A%E5%AE%9E%E6%97%B6%E8%AF%AD%E9%9F%B3%E5%A4%84%E7%90%86%E3%80%8B%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%20%E5%8F%91%E5%A3%B0%E6%9C%BA%E7%90%86/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://s2.loli.net/2022/05/16/GgQ5D9nwpHSJm6u.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://s2.loli.net/2022/05/16/GgQ5D9nwpHSJm6u.png">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                《实时语音信号处理》学习笔记 信号处理基础 发声机理</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2022/05/13/%E8%AF%AD%E9%9F%B3%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89DSP%E5%9F%BA%E7%A1%80/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://s2.loli.net/2022/05/12/qMxpGZJHSl4AuC7.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://s2.loli.net/2022/05/12/qMxpGZJHSl4AuC7.png">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                语音信号处理（二）DSP基础</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      <!--
  原来 ：
<script src="//cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script>
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "",
        appKey: "",
        path: window.location.pathname,
        placeholder: "快来留言鸭~ ..."
      })
  }
</script>
 -->


  <div id="vcomments"></div>
  <!-- 先引入样式,从footer提前 -->
  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script>
  <!-- 评论框美化 -->
  <script>
      new Valine({
          el: '#vcomments',
          appId: "DpQvbSVQXSeUV8lRSV5zHiOY-gzGzoHsz",
          appKey: "j8tFI5wuIwD7gTt7KJe5ohod",
         notify: 'false' === 'false',
         verify: 'true' === 'true',
         visitor: 'false' === 'false',
          path: window.location.pathname,
          verify: true,
          avatar: 'monsterid',//小怪物头像
          placeholder: "你是我一生只会遇见一次的惊喜 ..."  
      });
      //   自定义邮箱审核规则
      document.body.addEventListener('click', function(e) {
          if (e.target.classList.contains('vsubmit')) {
              const email = document.querySelector('input[type=email]');
              const nick = document.querySelector('input[name=nick]');
              const reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
              if (!email.value || !nick.value || !reg.test(email.value)) {
                  const str = `<div class="valert text-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                  const vmark = document.querySelector('.vmark');
                  vmark.innerHTML = str;
                  vmark.style.display = 'block';
                  setTimeout(function() {
                      vmark.style.display = 'none';
                      vmark.innerHTML = '';
                  }, 2500);
              }
          }
      });
      // 点击回复直接评论,官方版本点击回复时都是跳回到页面上方的评论框进行回复，评论框是固定不动的
      // 参考https://immmmm.com/valine-diy,用到jQuery
      $(document).ready(function(){
          //$('.vemoji-btn').text('😀');
          $("#vcomments").on('click', 'span.vat',function(){
              $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
              $('textarea#veditor').focus();
          })
      })
  </script>
  <!-- 今日诗词：随机返回一句古诗词名句的接口，宅到用来做 Valine 的 placeholder 显示内容 -->
  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
  <script type="text/javascript">
      jinrishici.load(function(result) {
          var jrsc_plac =  result.data.content + "\n「" + result.data.origin.title + "」" + result.data.origin.dynasty + " · " + result.data.origin.author
          document.getElementById("veditor").setAttribute("placeholder",jrsc_plac);
      });
  </script>
  
  
  



      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="/about/" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/custom/avatar.jpg" itemprop="image" alt="differencer" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="/about/" itemprop="url" rel="author">differencer</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 taotaozi<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<!--<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>-->
<script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
<!--<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>-->
<script src='https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js'></script>


<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"0","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"0","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
    <!-- 实现换肤功能 -->
  <div class="skin-menu no-select" id="mainskin" style="position: fixed">
    <div class="theme-controls row-container">
     <ul class="menu-list">
      <li id="white-bg"> <i class="fa fa-television" aria-hidden="true"></i></li>
      <li id="sakura-bg"> <i class="iconfont icon-sakura"></i></li>
      <li id="gribs-bg"> <i class="fa fa-slack" aria-hidden="true"></i></li>
      <li id="KAdots-bg"> <i class="iconfont icon-dots"></i></li>
      <li id="totem-bg"> <i class="fa fa-optin-monster" aria-hidden="true"></i></li>
      <li id="pixiv-bg"> <i class="iconfont icon-pixiv"></i></li>
      <li id="bing-bg"> <i class="iconfont icon-bing"></i></li>
      <li id="dark-bg"> <i class="fa fa-moon-o" aria-hidden="true"></i></li>
     </ul>
    </div>
   </div>
   <canvas id="night-mode-cover"></canvas>
    
  <div class="changeSkin-gear no-select">
    <div class="keys" id="setbtn"> 
     <span id="open-skinMenu"> 切换主题 | SCHEME TOOL  
       <i class="iconfont icon-gear inline-block rotating"></i> 
     </span>
    </div>
  </div>
  

  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">没错就是爱折腾</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/honjun" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://weibo.com/u/5856795355" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
        <a href="https://qm.qq.com/cgi-bin/qm/qr?k=zmOXfVpgH9H3Dx_n6PfhtJ3og3wdSh9K&noverify=0" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/archives">
                  <i class="fa fa-archive faa-shake" aria-hidden="true"></i>
                  时轴
                </a>
              </li>
            
              <li>
                <a href="/categories/%E6%8A%80%E6%9C%AF/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%94%9F%E6%B4%BB/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/%E5%85%B6%E4%BB%96/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  其他
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/%E9%98%85%E8%AF%BB/">
                  <i class="fa fa fa-book faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-bar-chart faa-shake" aria-hidden="true"></i>
            统计
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/">
                  <i class="fa fa-book faa-bounce" aria-hidden="true"></i>
                  标签
                </a>
              </li>
            
              <li>
                <a href="/categories/">
                  <i class="fa fa-tasks faa-shake" aria-hidden="true"></i>
                  分类
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/links/">
                  <i class="fa fa-link faa-shake" aria-hidden="true"></i>
                  友链
                </a>
              </li>
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="2660651585"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>