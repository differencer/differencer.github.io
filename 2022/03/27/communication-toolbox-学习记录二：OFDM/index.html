<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">Get Started with Communications Toolbox -Communications Toolbox 学习系列（二） | t&#39;blog</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "没错就是爱折腾";
  mashiro_option.author_name = "就是爱折腾";
  mashiro_option.site_url = "/about/";
  /*
  mashiro_option.v_appId = "";
  mashiro_option.v_appKey = "";
  */
  mashiro_option.v_appId = "";
  mashiro_option.v_appKey = "";

  
  mashiro_option.mathjax = "1";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(1).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(2).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(3).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(4).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(5).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(6).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(7).jpg.webp,https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/cover/(8).jpg.webp".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
<meta name="generator" content="Hexo 6.1.0"></head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="/about/">
          <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>Better to ask the way than go astray</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/differencer" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://weibo.com/u/5856795355" target="_blank" class="social-github" title="sina">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/sina.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://space.bilibili.com/20713910" target="_blank" class="social-github" title="bilibili">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/bilibili.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://blog.csdn.net/differencer?type=blog" target="_blank" class="social-github" title="CSDN">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/csdn.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/social/qq.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/qq.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">没错</span>
            <span class="shironeko">就是爱折腾</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/archives">
                          <i class="fa fa-archive faa-shake" aria-hidden="true"></i>
                          时轴
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%94%9F%E6%B4%BB/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E5%85%B6%E4%BB%96/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          其他
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/%E9%98%85%E8%AF%BB/">
                          <i class="fa fa fa-book faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-bar-chart faa-shake" aria-hidden="true"></i>
                    统计
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/">
                          <i class="fa fa-book faa-bounce" aria-hidden="true"></i>
                          标签
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/">
                          <i class="fa fa-tasks faa-shake" aria-hidden="true"></i>
                          分类
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/links/">
                          <i class="fa fa-link faa-shake" aria-hidden="true"></i>
                          友链
                        </a>
                      </li>
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://s2.loli.net/2022/03/28/qlVNcWvT3dgf1mr.png);" src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://s2.loli.net/2022/03/28/qlVNcWvT3dgf1mr.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      Get Started with Communications Toolbox -Communications Toolbox 学习系列（二）</h1>
      <p class="entry-census">
        <span>
          <a href="/about/">
            <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/custom/avatar.jpg">
          </a>
        </span>
        <span>
          <a href="/about/">differencer</a>
        </span>
        <span class="bull">
        ·</span>
        2022-3-27<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <p>少说废话，现在开始看看下一个案例吧！</p>
<p>这篇只写一个案例，因为这个案例还是比较复杂的，分成了多个步骤</p>
<h1 id="案例：matlab-仿真OFDM系统"><a href="#案例：matlab-仿真OFDM系统" class="headerlink" title="案例：matlab 仿真OFDM系统"></a>案例：matlab 仿真OFDM系统</h1><p>正交频分复用 (OFDM) 是现代无线通信系统（如 5G 和 LTE 蜂窝以及 WiFi）使用的多载波数字调制技术。<br>与单载波 QAM 等其他技术相比，OFDM 的优势包括支持更高的数据速率和更简单的接收器设计。<br>具体而言，使用带有循环前缀 (CP) 的 OFDM 可以实现基于快速傅里叶变换 (FFT) 的均衡和同步，与用于在单载波 QAM 中接收可比数据速率的技术相比，这简化了接收。</p>
<h2 id="1、OFDM-介绍"><a href="#1、OFDM-介绍" class="headerlink" title="1、OFDM 介绍"></a>1、OFDM 介绍</h2><p>正交频分复用 (OFDM) 通过将调制的高带宽信号载波划分到许多调制的窄带子载波上来实现高数据速率传输。对于 OFDM 传输，窄带子载波的使用降低了对频率选择性衰落的敏感度。许多最新的无线和电信标准都使用多载波 OFDM 调制格式。<br>在单载波系统中支持高数据速率需要宽带载波，有较短的符号持续时间。宽带载波通过频率选择性多径信道过滤宽带宽载波会严重降低信号质量，因为信道脉冲响应在时间上跨越多个符号并使信号容易受到符号间干扰 (ISI) 的影响。</p>
<p>为了避免在传输许多并行低带宽信号时出现 ISI，各个子载波必须相互正交。通过传输许多正交低带宽子载波来避免 ISI 激发了 OFDM。OFDM 调制器将高速率串行符号流转换为许多并行低速率流。每个正交低速率流遇到一个具有最小 ISI 的相对平坦的信道，并且可以很容易地均衡。</p>
<p>举个例子：</p>
<blockquote>
<p>一个信号，其脉冲持续时间为$T_{sym}&#x3D;0.25 sec$,那么符号速率为$R_{sym}&#x3D;1&#x2F;T_{sym}&#x3D;8Hz$,<br>将这个脉冲乘以数倍于$R_{sym}$ 如 频率为$R_{sym}、2R_{sym}、3R_{sym}$的余弦波，得到下图：<br>时域图：<br><img src="https://ww2.mathworks.cn/help/examples/comm/win64/IntroToOFDMExample_03.png"><br>频域图：<br><img src="https://ww2.mathworks.cn/help/examples/comm/win64/IntroToOFDMExample_04.png"></p>
</blockquote>
<p>可以发现，每个子载波的频谱峰值出现在所有其他脉冲的过零处。<br>OFDM 调制器将所有这些子载波加在一起以形成其输出信号。子载波数据可以用不同的调制方式。<br>这里，子载波使用 QAM 方法进行基带调制。<br>数学上，OFDM调制符号采样输出为<br>$$<br>s(k)&#x3D;\sum_{m&#x3D;0}^{N-1} a_{m, n} e^{j 2 \pi m R_{\mathrm{sym}} k\left(\frac{T_{\mathrm{sym}}}{N}\right)}<br>$$<br>其中</p>
<ul>
<li>$a_{m, n}$是第$n$个（时域）OFDM调制符号的第$m$个子载波的 符号</li>
<li>$R_{\mathrm{sym}}$是每个QAM符号流的符号速率</li>
<li>$T_{\mathrm{sym}}&#x3D;1&#x2F;R_{\mathrm{sym}}$</li>
<li>$N$是子载波的数量 或者说是QAM符号流的数量</li>
</ul>
<p>公式也可以简写为<br>$$<br>s(k)&#x3D;\sum_{m&#x3D;0}^{N-1} a_{m, n} e^{j 2 \pi\left(\frac{m k}{N}\right)}<br>$$</p>
<p>这数学上恰好与$a_{m, n}$的离散傅里叶反变换不谋而合。</p>
<h2 id="2、没有循环前缀的OFDM-仿真"><a href="#2、没有循环前缀的OFDM-仿真" class="headerlink" title="2、没有循环前缀的OFDM 仿真"></a>2、没有循环前缀的OFDM 仿真</h2><p>首先，OFDM符号我们采用 OFDM 子载波数据用QAM调制的方案，将这些数据作为子载波前面的系数，然后利用快速傅里叶反变换（IFFT），将并行传输的数据 转换为一个个相互正交的子载波的叠加。因为每一个子载波传输的数据非常少（一个OFDM符号周期才传输一个QAM符号），所以每个子载波都是窄带的，所以大概里经历平坦衰落，接收端的均衡器均衡器每个子载波仅需要一个抽头。</p>
<p>这是一个16QAM+OFDM的程序仿真</p>
<h3 id="2-1、信源端"><a href="#2-1、信源端" class="headerlink" title="2.1、信源端"></a>2.1、信源端</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">bps <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token comment">% Bits per symbol</span>
M <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">^</span>bps<span class="token punctuation">;</span>  <span class="token comment">% 16QAM</span>
nFFT <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">% Number of FFT bins</span>

txsymbols <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span> M<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nFFT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
txgrid <span class="token operator">=</span> <span class="token function">qammod</span><span class="token punctuation">(</span>txsymbols<span class="token punctuation">,</span>M<span class="token punctuation">,</span>UnitAveragePower<span class="token operator">=</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
txout <span class="token operator">=</span> <span class="token function">ifft</span><span class="token punctuation">(</span>txgrid<span class="token punctuation">,</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stem</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nFFT<span class="token punctuation">,</span><span class="token function">real</span><span class="token punctuation">(</span>txout<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://ww2.mathworks.cn/help/examples/comm/win64/BasicOFDMWithNoCyclicPrefixExample_01.png"></p>
<h3 id="2-2、信道"><a href="#2-2、信道" class="headerlink" title="2.2、信道"></a>2.2、信道</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">rxin <span class="token operator">=</span> <span class="token function">awgn</span><span class="token punctuation">(</span>txout<span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
rxgrid <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span>rxin<span class="token punctuation">,</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
rxsymbols <span class="token operator">=</span> <span class="token function">qamdemod</span><span class="token punctuation">(</span>rxgrid<span class="token punctuation">,</span>M<span class="token punctuation">,</span>UnitAveragePower<span class="token operator">=</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token function">isequal</span><span class="token punctuation">(</span>txsymbols<span class="token punctuation">,</span>rxsymbols<span class="token punctuation">)</span> 
    <span class="token function">disp</span><span class="token punctuation">(</span> "恢复的符号与传输的符号匹配。" <span class="token punctuation">)</span>
 <span class="token keyword">else</span> 
    <span class="token function">disp</span><span class="token punctuation">(</span> "恢复的符号与传输的符号不匹配。" <span class="token punctuation">)</span>
 <span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>IFFT 的所有 bin（应该是指输入系数） 都填充有用数据。在实际系统中，边缘端子载波通常留空以用作保护带，并且一些子载波 可用于发送特定的导频信号。保护带和导频信号的组合有助于同步和均衡。   </p>
<h2 id="3、均衡、卷积、以及循环前缀"><a href="#3、均衡、卷积、以及循环前缀" class="headerlink" title="3、均衡、卷积、以及循环前缀"></a>3、均衡、卷积、以及循环前缀</h2><h3 id="3-1、频域均衡"><a href="#3-1、频域均衡" class="headerlink" title="3.1、频域均衡"></a>3.1、频域均衡</h3><p>这个例子介绍了频域均衡，并展示了如何将循环卷积“转换”（其实不叫转换，得到前len(u)个想要的结果）为线性卷积</p>
<p>当考虑线性信道模型时，接收信号是发射信号与信道脉冲响应的卷积。<br>也即：<br>$$Y(f)&#x3D;H(f)U(f)$$</p>
<p>只要知道了频域相应$H(f)$,就还可以得到信号,即$$U(f)&#x3D;\frac{Y(f)}{H(f)}$$<br>其实这个式子就是频域均衡</p>
<h3 id="3-2、卷积"><a href="#3-2、卷积" class="headerlink" title="3.2、卷积"></a>3.2、卷积</h3><p>但是FFT处理产生的其实是信号$u$和$h$的循环卷积（这是为啥？），为了将这种循环卷积转换为线性卷积，$u$,$h$填充零的个数至少到 length(u)+length(h)-1 (<strong>填零策略</strong>)</p>
<blockquote>
<p>如果得到的必是循环卷积，那么，子载波数量N应该是len(u)+len(h)-1,</p>
</blockquote>
<blockquote>
<p>eg:输入8个数据，信道冲击为3径，那么N至少为8+3-1&#x3D;10<br>也就是填2个0</p>
</blockquote>
<p>看一个循环卷积和线性卷积的区别例子</p>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">u1 <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">;</span> 
h <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.4</span> <span class="token number">1</span> <span class="token number">0.4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

figure
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">stem</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">axis</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">10</span> <span class="token number">0</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>"Input signal"<span class="token punctuation">)</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">stem</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">axis</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">10</span> <span class="token number">0</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>"Channel impulse response"<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://ww2.mathworks.cn/help/examples/comm/win64/EqualizationConvolutionAndCyclicPrefixAdditionExample_01.png"></p>
<p>循环前缀能够把信道消弭未知信道时延的影响（循环长度大于最大信道时延长度即可）</p>
<h3 id="3-3、循环前缀"><a href="#3-3、循环前缀" class="headerlink" title="3.3、循环前缀"></a>3.3、循环前缀</h3><p>对于 OFDM 处理，循环卷积的必要填充是通过添加 CP 而不是对信号进行零填充来提供的。添加重复符号结束样本的 CP 可启用：</p>
<ul>
<li>通过IFFT&amp;FFT计算的卷积转换为循环卷积</li>
<li>用于信道估计、均衡和同步的简单频域处理</li>
<li>用于前向纠错方案的重复样本</li>
</ul>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">L <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">% Length of channel</span>
N <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">% Length of input signal</span>
ucp <span class="token operator">=</span> <span class="token function">u1</span><span class="token punctuation">(</span>N<span class="token operator">-</span>L<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">% Use last samples of input signal as the CP</span>
u2 <span class="token operator">=</span> <span class="token punctuation">[</span>ucp u1<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">% Prepend the CP to the input signal</span>
yl2 <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>u2<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">% Convolution of input+CP and channel</span>
yl2 <span class="token operator">=</span> <span class="token function">yl2</span><span class="token punctuation">(</span>L<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% Remove CP to compare signals</span>

figure<span class="token punctuation">;</span>
<span class="token function">stem</span><span class="token punctuation">(</span>yc1<span class="token punctuation">,</span>"x"<span class="token punctuation">)</span>
hold on<span class="token punctuation">;</span>
<span class="token function">stem</span><span class="token punctuation">(</span>yl2<span class="token punctuation">,</span>"o"<span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>"Convolution Results with Cyclic Prefix"<span class="token punctuation">)</span>
<span class="token function">legend</span> <span class="token punctuation">(</span>"Linear"<span class="token punctuation">,</span>"Circular"<span class="token punctuation">,</span>"Location"<span class="token punctuation">,</span>"northwest"<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://ww2.mathworks.cn/help/examples/comm/win64/EqualizationConvolutionAndCyclicPrefixAdditionExample_03.png"></p>
<p>对比循环卷积与线性卷积的误差使得否达到要求</p>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab"><span class="token keyword">if</span> <span class="token function">max</span><span class="token punctuation">(</span>yc1 <span class="token operator">-</span> <span class="token function">yl2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1e-8</span>
    <span class="token function">disp</span><span class="token punctuation">(</span>"Linear and circular convolution sequences match<span class="token punctuation">.</span>"<span class="token punctuation">)</span>
<span class="token keyword">else</span>
    <span class="token function">disp</span><span class="token punctuation">(</span>"Received symbols do not match transmitted symbols<span class="token punctuation">.</span>"<span class="token punctuation">)</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4、加CP的OFDM仿真"><a href="#4、加CP的OFDM仿真" class="headerlink" title="4、加CP的OFDM仿真"></a>4、加CP的OFDM仿真</h2><p>在这个案例中，将构建一个带有循环前缀的16QAM &amp; OFDM 仿真<br>为了能有效的均衡，循环前缀的长度必须大于信道长度（上一节说了，只有填零或者前缀的个数大于len（u）+len（h）-1 才有可能将循环卷积“转换”为线性卷积）</p>
<h3 id="4-1、基本参数"><a href="#4-1、基本参数" class="headerlink" title="4.1、基本参数"></a>4.1、基本参数</h3><p>定义 QAM 和 OFDM 处理的变量。生成符号、QAM 调制、OFDM 调制，然后将 CP 添加到信号中。多个OFDM符号可以同时处理然后串行化。</p>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">bps <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token comment">% Number of bits per symbol  相当于之前的k = log2(M)</span>
M <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">^</span>bps<span class="token punctuation">;</span>  <span class="token comment">% Modulation order</span>
nFFT <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">% Number of FFT bins</span>
nCP <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token comment">% CP length</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-2-发射端"><a href="#4-2-发射端" class="headerlink" title="4.2 发射端"></a>4.2 发射端</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">txsymbols <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span> M<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nFFT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
txgrid <span class="token operator">=</span> <span class="token function">qammod</span><span class="token punctuation">(</span>txsymbols<span class="token punctuation">,</span>M<span class="token punctuation">,</span>UnitAveragePower<span class="token operator">=</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
txout <span class="token operator">=</span> <span class="token function">ifft</span><span class="token punctuation">(</span>txgrid<span class="token punctuation">,</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">% To process multiple symbols, vectorize the txout matrix</span>
<span class="token comment">% 这一步不太明白，我测试了一下，好像有没有这一句没区别啊!</span>
txout <span class="token operator">=</span> <span class="token function">txout</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">% 取cp、加cp</span>
txcp <span class="token operator">=</span> <span class="token function">txout</span><span class="token punctuation">(</span>nFFT<span class="token operator">-</span>nCP<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
txout <span class="token operator">=</span> <span class="token punctuation">[</span>txcp<span class="token punctuation">;</span> txout<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-3、噪声部分-（噪声、频选、延迟）"><a href="#4-3、噪声部分-（噪声、频选、延迟）" class="headerlink" title="4.3、噪声部分 （噪声、频选、延迟）"></a>4.3、噪声部分 （噪声、频选、延迟）</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">hchan <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.4</span> <span class="token number">1</span> <span class="token number">0.4</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>       <span class="token comment">% 信道冲激响应</span>
rxin <span class="token operator">=</span> <span class="token function">awgn</span><span class="token punctuation">(</span>txout<span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">% Add noise   </span>
rxin <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>rxin<span class="token punctuation">,</span>hchan<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">% Add frequency dependency</span>
channelDelay <span class="token operator">=</span> dsp<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% Could use fractional delay 我发现效果就是第一个数据是零后面的数据是原数据往后移动一位</span>
rxin <span class="token operator">=</span> <span class="token function">channelDelay</span><span class="token punctuation">(</span>rxin<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">% Add delay</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-4、接收端"><a href="#4-4、接收端" class="headerlink" title="4.4、接收端"></a>4.4、接收端</h3><p>添加一个小于 CP 长度的随机偏移量。零模型的偏移设置可在发射和接收信号之间实现完美同步？。任何小于 CP 长度的时序偏移都可以通过额外的线性相位进行均衡补偿。<br>[这个偏移量offset 到底有什么用？为什么设成随机的，难道是信道参数吗？？]<br>答：</p>
<ul>
<li>1、可能是模拟了一个信道产生的频偏，是信道参数。</li>
<li>2、可能是同步时产生的误差（没有找到正确的OFDM信号开始的位置）<br>（以下结论参考自北京大学赵玉萍OFDM系统的频偏与时篇PPT）<br><img src="https://s2.loli.net/2022/04/01/PMe56Dc3wE2KuIQ.png"></li>
<li>载波频率偏移对于低频信号的作用相当于在OFDM时域采样序列上增添了一个等效指数因子</li>
<li>该因子是随着时间连续变化的，即 n &#x3D; 0 ~ N</li>
<li>频偏对系统的影响可写为归一化频偏的函数$\epsilon&#x3D;df&#x2F;\Delta f$($\Delta f$是子载波间隔、$df$是频偏)</li>
</ul>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">offset <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span>nCP<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">% random offset less than length of CP</span>
<span class="token comment">% Remove CP and synchronize the received signal</span>
<span class="token comment">% 下面这一步1、去掉了CP头，2、假设完美同步（时延消除）3、往前多了 offset</span>
rxsync <span class="token operator">=</span> <span class="token function">rxin</span><span class="token punctuation">(</span>nCP<span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span>channelDelay<span class="token punctuation">.</span>Length<span class="token operator">-</span>offset<span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rxgrid <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span><span class="token function">rxsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">,</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>至于为什么取rxsync &#x3D; rxin(nCP+1+channelDelay.Length-offset:end); 就能表示频偏还是不太明白。<br>可能的推导思路：</p>
<blockquote>
<p>设<strong>发射端</strong>经过IFFT变换之后传输信号为：<br>$$<br>\boldsymbol{s}(\boldsymbol{n})&#x3D;\sum_{l&#x3D;0}^{N-1} X(l) e^{j \frac{2 \pi}{N} n l}<br>$$<br>若接收信号存在频率偏移, 此时信号应表示为<br>$$<br>\boldsymbol{r}(\boldsymbol{n})&#x3D;\sum_{l&#x3D;0}^{N-1} X(l) e^{j \frac{2 \pi}{N} n l} e^{j \frac{2 \pi}{N} n \epsilon}+\boldsymbol{w}(n)&#x3D;\sum_{l&#x3D;0}^{N-1} X(l) e^{j \frac{2 \pi}{N} n (l+\epsilon)}+\boldsymbol{w}(n)<br>$$<br>$\boldsymbol{w}(n)$ 为高斯噪声的取样值</p>
</blockquote>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% 是否使用均衡？</span>
useEqualizer <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token keyword">if</span> useEqualizer
    hfchan <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span>hchan<span class="token punctuation">,</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">% 毫无疑问，hfchan是信道的频域相应，</span>
    <span class="token comment">% Linear phase term related to timing offset</span>
    offsetf <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1i</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span>offset <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span>nFFT<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token operator">/</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">%这一步好像是给信号应该是将原来的频偏给消除了</span>
    rxgrideq <span class="token operator">=</span> rxgrid <span class="token operator">./</span> <span class="token punctuation">(</span>hfchan <span class="token operator">.*</span> offsetf<span class="token punctuation">)</span><span class="token punctuation">;</span>

    
<span class="token keyword">else</span> <span class="token comment">% Without equalization errors occur</span>
    rxgrideq <span class="token operator">=</span> rxgrid<span class="token punctuation">;</span>
<span class="token keyword">end</span>
rxsymbols <span class="token operator">=</span> <span class="token function">qamdemod</span><span class="token punctuation">(</span>rxgrideq<span class="token punctuation">,</span>M<span class="token punctuation">,</span>UnitAveragePower<span class="token operator">=</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token function">max</span><span class="token punctuation">(</span>txsymbols <span class="token operator">-</span> rxsymbols<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1e-8</span>
    <span class="token function">disp</span><span class="token punctuation">(</span>"Receiver output matches transmitter input<span class="token punctuation">.</span>"<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
    <span class="token function">disp</span><span class="token punctuation">(</span>"Received symbols do not match transmitted symbols<span class="token punctuation">.</span>"<span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="5、the-final-matlab-OFDM-仿真"><a href="#5、the-final-matlab-OFDM-仿真" class="headerlink" title="5、the final - matlab OFDM 仿真"></a>5、the final - matlab OFDM 仿真</h2><h3 id="5-1、-基本配置"><a href="#5-1、-基本配置" class="headerlink" title="5.1、 基本配置"></a>5.1、 基本配置</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">k <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>       <span class="token comment">% Number of bits per symbol </span>
M <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">^</span>k<span class="token punctuation">;</span>     <span class="token comment">% Modulation order</span>
nFFT <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>  <span class="token comment">% Number of FFT bins</span>
cplen <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">% CP length</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-2、-发射端"><a href="#5-2、-发射端" class="headerlink" title="5.2、 发射端"></a>5.2、 发射端</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">txsymbols <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span> M<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nFFT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
txgrid <span class="token operator">=</span> <span class="token function">qammod</span><span class="token punctuation">(</span>txsymbols<span class="token punctuation">,</span>M<span class="token punctuation">,</span>UnitAveragePower<span class="token operator">=</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
txout <span class="token operator">=</span> <span class="token function">ifft</span><span class="token punctuation">(</span>txgrid<span class="token punctuation">,</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
txout <span class="token operator">=</span> <span class="token function">txout</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% Vectorize matrix if processing multiple symbols</span>
txcp <span class="token operator">=</span> <span class="token function">txout</span><span class="token punctuation">(</span>nFFT<span class="token operator">-</span>cplen<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
txout <span class="token operator">=</span> <span class="token punctuation">[</span>txcp<span class="token punctuation">;</span> txout<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>一个OFDM符号的时间长度$T_{symbol}$是子载波间隔$\Delta f$的倒数(因为OFDM符号是各个子载波信号在时域上的叠加，所以一个符号时间就是一个子载波的符号周期，而一个子载波的符号时间等于器在载波间隔的倒数)</li>
<li><strong>一个OFDM符号</strong>我们用<strong>N（nFFT）个采样点</strong>表示 这里是128点</li>
<li>所以采样点之间的时间间隔为  $T_{symbol}&#x2F;N$ , 采样频率为 $N \Delta f $，所以这里为什么除以2呢？？？？奇怪。</li>
</ul>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">scs <span class="token operator">=</span> <span class="token number">20e3</span><span class="token punctuation">;</span>        <span class="token comment">% Subcarrier spacing in Hz  子载波间隔？</span>
Fs <span class="token operator">=</span> scs <span class="token operator">*</span> nFFT<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">% Sampling rate (1.28e6 Hz) 采样频率</span>
Ts <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> Fs<span class="token punctuation">;</span>       <span class="token comment">% Sample duration in seconds  </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">Tend <span class="token operator">=</span> Ts <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>txout<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
hold off
<span class="token function">plot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span>Ts<span class="token operator">:</span>Tend<span class="token punctuation">,</span><span class="token function">real</span><span class="token punctuation">(</span>txout<span class="token punctuation">)</span><span class="token punctuation">,</span>"<span class="token operator">*</span>"<span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>"Real component of transmitter output"<span class="token punctuation">)</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span>
hold off
<span class="token function">plot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span>Ts<span class="token operator">:</span>Tend<span class="token punctuation">,</span><span class="token function">imag</span><span class="token punctuation">(</span>txout<span class="token punctuation">)</span><span class="token punctuation">,</span>"<span class="token operator">*</span>"<span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>"Imaginary component of transmitter output"<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-2-1、-过采样"><a href="#5-2-1、-过采样" class="headerlink" title="5.2.1、 过采样"></a>5.2.1、 过采样</h3><p>Define an FFT length longer than nFFT to cause oversampling in time domain. To aid comparison later, insert zeros into the middle of txgrid to maintain correspondence between bin centers for the original and upsampled signals. A control here allows you to adjust the integer oversampling rate used by the OFDM modulator output and demodulator input.<br>定义一个长度大于nFFT的 FFT，这样可以在时域上过采样。为了便于比较，在 txgrid 的中间插入零以保持原始信号和上采样信号的 bin 中心之间的对应关系（为什么？）。upFactor 是过采样倍数可以自行调整</p>
<p>% 我更改了以下填零的顺序，发现并没有太大的变化，都能拟合<br>是那么叫保持原始信号和上采样 信号 系数中心之间的对应关系？有什么样的对应关系需要保持呢？</p>
<blockquote>
<p>答：在IFFT变换矩阵中，每行的前一半都是正频率而后一半都是负频率。因此，若要使用过采样，就应该将0添加到输入数据的中间而非末尾 —— 这样就能够确保添加的0数据值被映射到正和负频率一半的子载波上，而非0数据则被映射到0Hz附近的子载波上 <a target="_blank" rel="noopener" href="https://blog.csdn.net/misskissC/article/details/51315653">参考资料</a> ，<br>呃 还是没懂 ，他妈的</p>
</blockquote>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">upFactor <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
nFFTUp  <span class="token operator">=</span> upFactor <span class="token operator">*</span> nFFT<span class="token punctuation">;</span>
fftgrid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">txgrid</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nFFT<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">...</span>
    <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token punctuation">(</span>upFactor<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>nFFT<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">...</span>
    <span class="token function">txgrid</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nFFT<span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>nFFT<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">% Each column of fftgrid is one OFDM symbol</span>
txout <span class="token operator">=</span> upFactor <span class="token operator">*</span> <span class="token function">ifft</span><span class="token punctuation">(</span>fftgrid<span class="token punctuation">,</span>nFFTUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">% Vectorize the matrix to process multiple OFDM symbols</span>
txout <span class="token operator">=</span> <span class="token function">txout</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cplenUp <span class="token operator">=</span> cplen <span class="token operator">*</span> upFactor<span class="token punctuation">;</span>
txcp <span class="token operator">=</span> <span class="token function">txout</span><span class="token punctuation">(</span>nFFTUp<span class="token operator">-</span>cplenUp<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>nFFTUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
txout <span class="token operator">=</span> <span class="token punctuation">[</span>txcp<span class="token punctuation">;</span> txout<span class="token punctuation">]</span><span class="token punctuation">;</span>
Ts <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span>upFactor<span class="token operator">*</span>Fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
Tend <span class="token operator">=</span> Ts <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>txout<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
hold on
<span class="token function">plot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span>Ts<span class="token operator">:</span>Tend<span class="token punctuation">,</span><span class="token function">real</span><span class="token punctuation">(</span>txout<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">legend</span> <span class="token punctuation">(</span>"Original"<span class="token punctuation">,</span>"Upsampled"<span class="token punctuation">,</span>"Location"<span class="token punctuation">,</span>"southeast"<span class="token punctuation">)</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span>
hold on
<span class="token function">plot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span>Ts<span class="token operator">:</span>Tend<span class="token punctuation">,</span><span class="token function">imag</span><span class="token punctuation">(</span>txout<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">legend</span> <span class="token punctuation">(</span>"Original"<span class="token punctuation">,</span>"Upsampled"<span class="token punctuation">,</span>"Location"<span class="token punctuation">,</span>"southeast"<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://ww2.mathworks.cn/help/examples/comm/win64/OFDMWithFFTBasedOversamplingExample_01.png"></p>
<h3 id="5-3、信道"><a href="#5-3、信道" class="headerlink" title="5.3、信道"></a>5.3、信道</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">hchan <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.4</span> <span class="token number">1</span> <span class="token number">0.4</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>       <span class="token comment">% 信道冲击</span>
rxin <span class="token operator">=</span> <span class="token function">awgn</span><span class="token punctuation">(</span>txout<span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">% Add noise   </span>
rxin <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>rxin<span class="token punctuation">,</span>hchan<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">% Add frequency dependency</span>
channelDelay <span class="token operator">=</span> dsp<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% Could use fractional delay 时延</span>
rxin <span class="token operator">=</span> <span class="token function">channelDelay</span><span class="token punctuation">(</span>rxin<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">% Add delay</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>添加一个小于 CP 长度的随机偏移量。零模型的偏移设置可在发射和接收信号之间实现完美同步。任何小于 CP 长度的时序偏移都可以通过额外的线性相位进行均衡补偿。为了直接比较不同速率的信号，在 FFT 处理之前，通过上采样因子对同步信号进行归一化。</p>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">offset <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">randi</span><span class="token punctuation">(</span>cplenUp<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% random offset less than length of CP</span>
<span class="token comment">% Remove CP and synchronize the received signal</span>
rxsync <span class="token operator">=</span> <span class="token function">rxin</span><span class="token punctuation">(</span>cplenUp<span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span>channelDelay<span class="token punctuation">.</span>Length<span class="token operator">-</span>offset<span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rxgrid <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span><span class="token function">rxsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nFFTUp<span class="token punctuation">)</span><span class="token punctuation">,</span>nFFTUp<span class="token punctuation">)</span><span class="token operator">/</span>upFactor<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-4-接收端均衡"><a href="#5-4-接收端均衡" class="headerlink" title="5.4 接收端均衡"></a>5.4 接收端均衡</h3><pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">useEqualizer <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token keyword">if</span> useEqualizer
    <span class="token comment">%注意，接收端iFFT采用的是 nFFT×过采样倍数 的点数！！！！！！！！</span>
    hfchan <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span>hchan<span class="token punctuation">,</span>nFFTUp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">% Linear phase term related to timing offset</span>
    offsetf <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1i</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span>offset <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span>nFFTUp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token operator">/</span>nFFTUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rxgrideq <span class="token operator">=</span> rxgrid <span class="token operator">./</span> <span class="token punctuation">(</span>hfchan <span class="token operator">.*</span> offsetf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token comment">% Without equalization errors occur</span>
    rxgrideq <span class="token operator">=</span> rxgrid<span class="token punctuation">;</span>
<span class="token keyword">end</span>
rxgridNoZeroPad <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">rxgrideq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>nFFT<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">...</span>
    <span class="token function">rxgrideq</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token punctuation">(</span>upFactor<span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">*</span>nFFT<span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">% 取前nFFT/2个，取后nFFT/2个</span>
rxsymbols <span class="token operator">=</span> <span class="token function">qamdemod</span><span class="token punctuation">(</span>rxgridNoZeroPad<span class="token punctuation">,</span>M<span class="token punctuation">,</span>UnitAveragePower<span class="token operator">=</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token function">max</span><span class="token punctuation">(</span>txsymbols <span class="token operator">-</span> rxsymbols<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1e-8</span>
    <span class="token function">disp</span><span class="token punctuation">(</span>"Oversampled receiver output matches transmitter input<span class="token punctuation">.</span>"<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
    <span class="token function">disp</span><span class="token punctuation">(</span>"Received symbols do not match transmitted symbols<span class="token punctuation">.</span>"<span class="token punctuation">)</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一小节先到这里啦~ 还有n多问题没有解决 555，主要集中在：<br>1、设置的偏移上（offset），rxsync &#x3D; rxin(cplenUp+1+channelDelay.Length-offset:end); 这里的意义<br>2、过采样的时候，在iFFT前  为什么中间填零，而不是两边？<br>3、3径信道的影响没看到呀，哦哦，可能是OFDM以为天然抵抗多径，所以没啥影响。</p>
<p>后续知道答案时会及时解决</p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/donate/AliPayQR.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2022/04/09/%E5%B0%8F%E8%AF%B4%E8%AF%84%E9%89%B4/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://s2.loli.net/2022/04/09/J8VN4LqQeyCzvHo.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://s2.loli.net/2022/04/09/J8VN4LqQeyCzvHo.jpg">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                小说评鉴</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2022/03/17/communication-toolbox-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E4%B8%80/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://s2.loli.net/2022/03/18/eyjk9Mdng4VTfS8.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://s2.loli.net/2022/03/18/eyjk9Mdng4VTfS8.jpg">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                Communications Toolbox 学习系列（一）</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      <!--
  原来 ：
<script src="//cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script>
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "",
        appKey: "",
        path: window.location.pathname,
        placeholder: "快来留言鸭~ ..."
      })
  }
</script>
 -->


  <div id="vcomments"></div>
  <!-- 先引入样式,从footer提前 -->
  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script>
  <!-- 评论框美化 -->
  <script>
      new Valine({
          el: '#vcomments',
          appId: "DpQvbSVQXSeUV8lRSV5zHiOY-gzGzoHsz",
          appKey: "j8tFI5wuIwD7gTt7KJe5ohod",
         notify: 'false' === 'false',
         verify: 'true' === 'true',
         visitor: 'false' === 'false',
          path: window.location.pathname,
          verify: true,
          avatar: 'monsterid',//小怪物头像
          placeholder: "你是我一生只会遇见一次的惊喜 ..."  
      });
      //   自定义邮箱审核规则
      document.body.addEventListener('click', function(e) {
          if (e.target.classList.contains('vsubmit')) {
              const email = document.querySelector('input[type=email]');
              const nick = document.querySelector('input[name=nick]');
              const reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
              if (!email.value || !nick.value || !reg.test(email.value)) {
                  const str = `<div class="valert text-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                  const vmark = document.querySelector('.vmark');
                  vmark.innerHTML = str;
                  vmark.style.display = 'block';
                  setTimeout(function() {
                      vmark.style.display = 'none';
                      vmark.innerHTML = '';
                  }, 2500);
              }
          }
      });
      // 点击回复直接评论,官方版本点击回复时都是跳回到页面上方的评论框进行回复，评论框是固定不动的
      // 参考https://immmmm.com/valine-diy,用到jQuery
      $(document).ready(function(){
          //$('.vemoji-btn').text('😀');
          $("#vcomments").on('click', 'span.vat',function(){
              $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
              $('textarea#veditor').focus();
          })
      })
  </script>
  <!-- 今日诗词：随机返回一句古诗词名句的接口，宅到用来做 Valine 的 placeholder 显示内容 -->
  <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
  <script type="text/javascript">
      jinrishici.load(function(result) {
          var jrsc_plac =  result.data.content + "\n「" + result.data.origin.title + "」" + result.data.origin.dynasty + " · " + result.data.origin.author
          document.getElementById("veditor").setAttribute("placeholder",jrsc_plac);
      });
  </script>
  
  
  



      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="/about/" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.5/img/custom/avatar.jpg" itemprop="image" alt="differencer" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="/about/" itemprop="url" rel="author">differencer</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 taotaozi<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<!--<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>-->
<script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
<!--<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>-->
<script src='https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js'></script>


<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"0","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"0","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
    <!-- 实现换肤功能 -->
  <div class="skin-menu no-select" id="mainskin" style="position: fixed">
    <div class="theme-controls row-container">
     <ul class="menu-list">
      <li id="white-bg"> <i class="fa fa-television" aria-hidden="true"></i></li>
      <li id="sakura-bg"> <i class="iconfont icon-sakura"></i></li>
      <li id="gribs-bg"> <i class="fa fa-slack" aria-hidden="true"></i></li>
      <li id="KAdots-bg"> <i class="iconfont icon-dots"></i></li>
      <li id="totem-bg"> <i class="fa fa-optin-monster" aria-hidden="true"></i></li>
      <li id="pixiv-bg"> <i class="iconfont icon-pixiv"></i></li>
      <li id="bing-bg"> <i class="iconfont icon-bing"></i></li>
      <li id="dark-bg"> <i class="fa fa-moon-o" aria-hidden="true"></i></li>
     </ul>
    </div>
   </div>
   <canvas id="night-mode-cover"></canvas>
    
  <div class="changeSkin-gear no-select">
    <div class="keys" id="setbtn"> 
     <span id="open-skinMenu"> 切换主题 | SCHEME TOOL  
       <i class="iconfont icon-gear inline-block rotating"></i> 
     </span>
    </div>
  </div>
  

  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/differencer/MyCDN@1.0.6/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">没错就是爱折腾</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/honjun" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://weibo.com/u/5856795355" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
        <a href="https://qm.qq.com/cgi-bin/qm/qr?k=zmOXfVpgH9H3Dx_n6PfhtJ3og3wdSh9K&noverify=0" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/archives">
                  <i class="fa fa-archive faa-shake" aria-hidden="true"></i>
                  时轴
                </a>
              </li>
            
              <li>
                <a href="/categories/%E6%8A%80%E6%9C%AF/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%94%9F%E6%B4%BB/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/%E5%85%B6%E4%BB%96/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  其他
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/%E9%98%85%E8%AF%BB/">
                  <i class="fa fa fa-book faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-bar-chart faa-shake" aria-hidden="true"></i>
            统计
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/">
                  <i class="fa fa-book faa-bounce" aria-hidden="true"></i>
                  标签
                </a>
              </li>
            
              <li>
                <a href="/categories/">
                  <i class="fa fa-tasks faa-shake" aria-hidden="true"></i>
                  分类
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/links/">
                  <i class="fa fa-link faa-shake" aria-hidden="true"></i>
                  友链
                </a>
              </li>
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="2660651585"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>